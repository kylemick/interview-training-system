# Capability: Weakness Management (弱点管理)

## Purpose

弱点管理能力为香港升中面试训练系统提供专门的弱点查看、管理和分析功能。通过独立的弱点管理页面，用户可以集中查看所有弱点记录，进行状态管理、批量操作，并通过统计和可视化了解弱点改善趋势，从而制定针对性的训练计划。

## Requirements

### Requirement: 弱点列表展示
系统SHALL提供弱点列表页面，支持多维度筛选、排序和分页。

#### Scenario: 查看弱点列表
- **WHEN** 用户访问 `/weaknesses` 页面
- **THEN** 系统显示所有弱点记录的列表
- **AND** 每个弱点显示：类别、弱点类型、严重程度、状态、描述、创建时间
- **AND** 列表支持按严重程度降序、创建时间降序排序（默认）

#### Scenario: 筛选弱点
- **WHEN** 用户在弱点列表页面使用筛选器
- **THEN** 系统支持按以下维度筛选：
  - 专项类别（七大类别：english-oral, chinese-oral等）
  - 状态（active/improved/resolved）
  - 严重程度（high/medium/low）
  - 弱点类型（vocabulary/grammar/logic/knowledge_gap/confidence/expression）
- **AND** 筛选条件可以组合使用
- **AND** 筛选结果实时更新

#### Scenario: 筛选预设
- **WHEN** 用户点击筛选预设按钮
- **THEN** 系统提供以下预设：
  - "高严重度活跃弱点"（severity=high, status=active）
  - "已改善弱点"（status=improved）
  - "已解决弱点"（status=resolved）
  - "全部弱点"（清除所有筛选）
- **AND** 点击预设后自动应用对应筛选条件

#### Scenario: 分页浏览
- **WHEN** 弱点数量超过单页显示限制
- **THEN** 系统提供分页控件
- **AND** 默认每页显示20条记录
- **AND** 用户可以调整每页显示数量（10/20/50/100）

### Requirement: 弱点详情查看
系统SHALL提供弱点详情页面，展示弱点的完整信息。

#### Scenario: 查看弱点详情
- **WHEN** 用户点击弱点列表中的某个弱点或访问 `/weaknesses/:id`
- **THEN** 系统显示弱点的完整信息：
  - 基本信息：类别、弱点类型、严重程度、状态
  - 描述：弱点详细描述
  - 示例文本：体现弱点的原文片段
  - 改进建议：具体的改进建议
  - 相关话题：相关话题标签列表
  - 练习历史：已练习次数、最后练习时间
  - 时间信息：创建时间、更新时间
  - 来源信息：识别方式（ai/manual）、来源文本（如有）

#### Scenario: 弱点详情页面操作
- **WHEN** 用户在弱点详情页面
- **THEN** 系统提供以下操作：
  - 更新状态（active/improved/resolved）
  - 删除弱点（需确认）
  - 生成针对性题目（调用AI生成）
  - 返回列表（导航按钮）

### Requirement: 弱点状态管理
系统SHALL支持更新弱点的状态，并显示确认对话框。

#### Scenario: 更新弱点状态
- **WHEN** 用户在弱点详情页面或列表中选择更新状态
- **THEN** 系统显示状态选择器（active/improved/resolved）
- **AND** 用户选择新状态后，系统显示确认对话框
- **AND** 用户确认后，调用 `PATCH /api/weaknesses/:id/status` 更新状态
- **AND** 更新成功后显示成功提示并刷新数据

#### Scenario: 批量更新状态
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量更新状态"
- **THEN** 系统显示状态选择器
- **AND** 用户选择新状态后，系统显示确认对话框（显示将更新的数量）
- **AND** 用户确认后，批量调用API更新所有选中弱点的状态
- **AND** 更新完成后显示成功提示（显示成功更新的数量）

### Requirement: 弱点删除
系统SHALL支持删除弱点记录，并显示确认对话框。

#### Scenario: 删除单个弱点
- **WHEN** 用户在弱点详情页面点击删除按钮
- **THEN** 系统显示确认对话框，提示"确定要删除此弱点记录吗？"
- **AND** 用户确认后，调用 `DELETE /api/weaknesses/:id` 删除记录
- **AND** 删除成功后显示成功提示并返回列表页面

#### Scenario: 批量删除弱点
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量删除"
- **THEN** 系统显示确认对话框，提示"确定要删除选中的 X 条弱点记录吗？"
- **AND** 用户确认后，批量调用API删除所有选中弱点
- **AND** 删除完成后显示成功提示（显示成功删除的数量）

### Requirement: 弱点统计展示
系统SHALL在弱点管理页面展示统计信息。

#### Scenario: 显示统计卡片
- **WHEN** 用户访问弱点管理页面
- **THEN** 系统在页面顶部显示统计卡片：
  - 总弱点数
  - 按状态分布（活跃/已改善/已解决）
  - 按严重程度分布（高/中/低）
  - 按类别分布（七大专项类别）
  - 按弱点类型分布（vocabulary/grammar等）
- **AND** 统计数据通过调用 `GET /api/weaknesses/stats/summary` 获取

#### Scenario: 统计卡片交互
- **WHEN** 用户点击统计卡片
- **THEN** 系统可以跳转到对应筛选条件的弱点列表（可选功能）

### Requirement: 弱点趋势可视化
系统SHALL在弱点管理页面展示趋势图表。

#### Scenario: 显示趋势图表
- **WHEN** 用户访问弱点管理页面
- **THEN** 系统显示以下图表：
  - 弱点趋势折线图：按周统计新增弱点数
  - 弱点类型分布饼图：各类型弱点数量占比
  - 改善率柱状图：按类型统计改善情况（改善率 = (已改善+已解决)/总数）
  - 高严重度弱点趋势图：按周统计高严重度弱点数量
  - 练习效果分析图：练习次数与改善率的关系
- **AND** 图表数据通过调用 `GET /api/weaknesses/stats/trends` 获取
- **AND** 图表使用 ECharts 或 Ant Design Charts 渲染

#### Scenario: 趋势图表时间范围
- **WHEN** 用户查看趋势图表
- **THEN** 系统默认显示最近30天的数据
- **AND** 用户可以调整时间范围（7天/30天/90天/全部）

### Requirement: 生成针对性题目
系统SHALL支持根据弱点生成针对性练习题目。

#### Scenario: 为单个弱点生成题目
- **WHEN** 用户在弱点详情页面点击"生成针对性题目"按钮
- **THEN** 系统调用 `POST /api/ai/generate-questions-from-weaknesses`
- **AND** 请求参数包含弱点ID和题目数量（默认5道）
- **AND** 生成成功后显示成功提示，并跳转到题目列表或练习页面

#### Scenario: 批量生成题目
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量生成题目"
- **THEN** 系统显示对话框，让用户选择题目数量（每弱点生成数量）
- **AND** 用户确认后，调用API为所有选中弱点生成题目
- **AND** 生成完成后显示成功提示（显示生成的题目总数）

### Requirement: 导航和菜单集成
系统SHALL在系统导航菜单中添加弱点管理入口。

#### Scenario: 导航菜单入口
- **WHEN** 用户查看系统导航菜单
- **THEN** 菜单中包含"弱点管理"项（使用 WarningOutlined 图标）
- **AND** 点击后跳转到 `/weaknesses` 页面
- **AND** 菜单项在"进度报告"和"设置"之间（或根据逻辑顺序排列）

#### Scenario: 面包屑导航
- **WHEN** 用户在弱点详情页面
- **THEN** 系统显示面包屑导航：首页 > 弱点管理 > 弱点详情
- **AND** 点击"弱点管理"可返回列表页面

### Requirement: 响应式设计
系统SHALL确保弱点管理页面在不同设备上正常显示。

#### Scenario: 桌面端显示
- **WHEN** 用户在桌面浏览器访问弱点管理页面
- **THEN** 列表以表格形式显示，充分利用屏幕空间
- **AND** 统计卡片和图表并排显示

#### Scenario: 移动端显示
- **WHEN** 用户在移动设备访问弱点管理页面
- **THEN** 列表以卡片列表形式显示（或响应式表格）
- **AND** 统计卡片垂直排列
- **AND** 图表自适应屏幕宽度
- **AND** 筛选器以抽屉或折叠面板形式展示

### Requirement: 错误处理和用户反馈
系统SHALL提供适当的错误处理和用户反馈。

#### Scenario: 加载状态
- **WHEN** 系统正在加载弱点数据
- **THEN** 显示加载动画（Spin组件）
- **AND** 禁用操作按钮

#### Scenario: 空状态
- **WHEN** 弱点列表为空（无数据或筛选后无结果）
- **THEN** 显示空状态提示（Empty组件）
- **AND** 提供"清除筛选"或"返回"操作

#### Scenario: 错误处理
- **WHEN** API调用失败
- **THEN** 显示错误提示（message.error）
- **AND** 错误信息清晰易懂（如"获取弱点列表失败，请稍后重试"）

#### Scenario: 操作成功反馈
- **WHEN** 用户成功执行操作（更新状态、删除、生成题目等）
- **THEN** 显示成功提示（message.success）
- **AND** 自动刷新相关数据
