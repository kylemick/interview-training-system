# 变更日志

本文档记录项目的重要变更和优化。

## [2026-01-25] 页面性能优化

### 概述
本次优化主要解决页面访问慢和刷新失败的问题，并建立了文档和测试规范。

### 性能优化

#### 前端优化
- ✅ **API 请求优化**
  - 实现请求去重机制：相同请求在 pending 时不重复发送
  - 实现请求取消机制：组件卸载时自动取消未完成的请求
  - 实现请求缓存：GET 请求缓存 5 分钟 TTL
  - 添加错误重试机制：网络错误时自动重试 1 次（指数退避）
  - 优化 API 超时设置：从 30 秒降低到 10 秒

- ✅ **React 性能优化**
  - 使用 `useMemo` 缓存计算结果
  - 使用 `useCallback` 缓存回调函数
  - 使用 `React.memo` 优化列表组件
  - 优化 columns 定义，避免每次渲染重新创建

- ✅ **页面优化**
  - Dashboard 页面：并行加载任务、会话、弱点数据
  - Questions 页面：并行加载题目、统计、学校列表
  - 统一使用 API 客户端，移除硬编码的 URL

#### 后端优化
- ✅ **数据库查询优化**
  - 查询性能监控：记录超过 100ms 的慢查询
  - 查询结果缓存：学校列表、统计信息等使用缓存（5 分钟 TTL）
  - JSON 字段统一解析：在数据库访问层统一解析，避免重复解析
  - 数据库索引：已为所有常用查询字段添加索引

- ✅ **路由优化**
  - 学校列表：使用缓存
  - 统计查询：使用缓存
  - JSON 字段解析：统一使用 `parseJsonField` 函数

### 问题修复

- ✅ **修复页面刷新问题**
  - Dashboard 页面刷新后数据正常加载
  - Questions 页面刷新后数据正常加载
  - 所有页面统一使用 API 客户端，解决刷新问题

- ✅ **修复前端访问后端问题**
  - 修复 Vite 代理配置：使用 `127.0.0.1` 替代 `localhost`
  - 统一所有页面的 API 调用，移除硬编码 URL
  - 修复 API 响应格式处理

### 文档和规范

- ✅ **建立文档规范**
  - 创建 `docs/DEVELOPMENT_GUIDE.md`：开发规范文档
  - 创建 `docs/PERFORMANCE.md`：性能优化文档
  - 更新 `DEVELOPER-GUIDE.md`：添加性能优化章节

- ✅ **建立测试规范**
  - 创建 `docs/TESTING_GUIDE.md`：测试规范文档
  - 建立测试覆盖率要求（至少 60%）
  - 创建测试检查清单模板

### 性能目标

- ✅ **前端性能**
  - 页面首次加载时间 < 1 秒（本地环境）
  - 所有页面刷新后能正常加载数据

- ✅ **后端性能**
  - API 响应时间 < 500ms（简单查询）
  - 复杂查询 < 2 秒
  - 慢查询监控（> 100ms）

### 技术债务

- [ ] 为关键 API 端点添加性能测试（可在后续迭代中添加）
- [ ] 运行所有现有测试确保没有破坏性变更（需要手动验证）
- [ ] 手动测试所有主要功能流程（需要手动验证）

### 影响范围

- **前端**：所有页面组件、API 客户端
- **后端**：所有路由、数据库访问层
- **文档**：新增开发规范、性能优化、测试规范文档

### 相关文档

- [性能优化文档](./PERFORMANCE.md)
- [开发规范文档](./DEVELOPMENT_GUIDE.md)
- [测试规范文档](./TESTING_GUIDE.md)
