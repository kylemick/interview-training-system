## 1. 修复模型路径配置

- [x] 1.1 修复 `LANGUAGE_MODEL_PATHS` 配置
  - 位置：`frontend/src/utils/voskRecognition.ts:29-32`
  - 将路径從 `.tar.gz` 文件改为解压後的目錄路径
  - 中文模型：`/models/vosk-model-small-cn-0.22`（去掉 `.tar.gz`）
  - 英文模型：`/models/vosk-model-small-en-us-0.22`（去掉 `.tar.gz`）

- [x] 1.2 更新 `VOICE_INPUT_SETUP.md` 文檔
  - 確保文檔中的路径說明与代碼一致
  - 明確說明模型应该是解压後的目錄，不是 `.tar.gz` 文件

## 2. 添加模型文件存在性检查

- [x] 2.1 实现模型文件检查函數
  - 位置：`frontend/src/utils/voskRecognition.ts`
  - 創建 `checkModelFileExists` 函數，检查模型文件是否存在
  - 使用 `fetch` 请求模型目錄下的關键文件（如 `am/final.mdl` 或 `graph/HCLr.fst`）
  - 返回检查結果和详细错误信息

- [x] 2.2 在模型加载前進行检查
  - 在 `VoskModelLoader.loadModel` 中，加载模型前先检查文件是否存在
  - 如果文件不存在，抛出清晰的错误信息，包含：
    - 模型文件路径
    - 下载链接或配置說明
    - 如何正確配置模型的步骤

## 3. 改進错误处理和用户提示

- [x] 3.1 增强 `VoskError` 错误類型
  - 添加错误代碼枚举，区分不同類型的错误：
    - `MODEL_FILE_NOT_FOUND`: 模型文件不存在
    - `MODEL_LOAD_NETWORK_ERROR`: 网络错误
    - `MODEL_LOAD_FORMAT_ERROR`: 模型格式错误
    - `MODEL_LOAD_PERMISSION_ERROR`: 权限错误
    - `MODULE_NOT_FOUND`: 依赖包未安装
    - `WASM_NOT_SUPPORTED`: WebAssembly 不支持

- [x] 3.2 改進错误消息
  - 为每種错误類型提供详细的中文错误消息
  - 包含具体的解决方案和操作步骤
  - 提供相關文檔链接

- [x] 3.3 在 `VoiceInput` 組件中显示详细错误信息
  - 位置：`frontend/src/components/VoiceInput.tsx`
  - 根據错误類型显示不同的错误提示
  - 提供操作按钮（重試、查看帮助、使用文本输入）

## 4. 添加错误恢复机制

- [x] 4.1 实现重試机制
  - 在 `VoiceInput` 組件中添加重試按钮
  - 重試時重新检查模型文件并尝試加载
  - 限制重試次數，避免无限循环

- [x] 4.2 实现優雅降级
  - 模型加载失敗時，自動隐藏語音输入按钮
  - 显示友好的提示信息，引導用户使用文本输入
  - 確保文本输入功能始终可用

- [x] 4.3 添加错误边界保护
  - 在 `VoiceInput` 組件中实现優雅降级（错误時返回 null）
  - 捕获組件內部的未处理错误，防止影响整个页面
  - 显示降级UI，允许用户继续使用其他功能

## 5. 完善错误日志和調試信息

- [x] 5.1 添加详细日志記錄
  - 記錄模型加载的每个步骤（開始加载、检查文件、加载進度、完成/失敗）
  - 記錄错误详情（错误類型、错误消息、堆栈信息）
  - 使用 `console.error` 記錄错误，便于開發調試

- [x] 5.2 添加調試工具函數
  - 創建 `checkVoiceInputSetup` 函數，检查語音输入功能的配置狀態
  - 检查項包括：
    - WebAssembly 支持
    - vosk-browser 包是否安装
    - 模型文件是否存在
    - 浏览器权限（麦克風）
  - 在開發模式下提供調試面板

## 6. 验证和测試

- [ ] 6.1 测試模型文件不存在的情况
  - 删除模型文件，验证错误提示是否正確
  - 验证降级机制是否正常工作

- [ ] 6.2 测試模型路径错误的情况
  - 修改模型路径为错误路径，验证错误处理
  - 验证错误消息是否清晰

- [ ] 6.3 测試网络错误情况
  - 模拟网络断開，验证错误处理
  - 验证重試机制是否正常工作

- [ ] 6.4 测試错误不會導致服務崩溃
  - 验证所有错误都被正確捕获
  - 验证错误不會導致未处理的 Promise 拒绝
  - 验证前端错误不會影响後端服務

- [ ] 6.5 测試完整流程
  - 正常加载模型并錄音
  - 模型加载失敗後的降级流程
  - 重試机制的工作流程
