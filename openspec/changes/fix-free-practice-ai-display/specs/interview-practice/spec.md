## MODIFIED Requirements

### Requirement: 啟動練習會話
係統 SHALL 允許用戶啟動新的練習會話，並根據訓練計劃選擇合適的題目。當題目不足時，系統會自動生成題目，此時前端必須使用 AI 懸浮窗組件展示 AI 思考過程。生成完成後，系統必須自動跳轉到練習頁面。

#### Scenario: 自由練習模式創建會話（題目充足）
- **WHEN** 用戶在自由練習模式下選擇專項類別和題目數量，點擊開始練習
- **AND** 該類別題庫中有足夠數量的可用題目
- **THEN** 系統直接從題庫中選擇題目並創建會話
- **AND** 系統自動跳轉到練習頁面，展示第一道題目
- **AND** 不顯示 AI 懸浮窗（因為沒有 AI 調用）

#### Scenario: 自由練習模式創建會話（題目不足，觸發 AI 生成）
- **WHEN** 用戶在自由練習模式下選擇專項類別和題目數量，點擊開始練習
- **AND** 該類別題庫中沒有足夠數量的可用題目
- **THEN** 系統調用 `api.sessions.create` 創建會話
- **AND** 後端自動檢測題目不足並調用 AI 生成題目
- **AND** 前端使用 `executeWithThinking` 包裝 API 調用，顯示 AI 懸浮窗
- **AND** 懸浮窗顯示「創建練習會話並生成題目」任務
- **AND** 用戶可以看到 AI 思考步驟（分析題目要求、生成題目內容等）
- **AND** 生成完成後，系統自動加載題目詳情
- **AND** 題目加載完成後，系統自動跳轉到練習頁面（`setStep('practice')`）
- **AND** 展示第一道題目給用戶

#### Scenario: 自由練習模式創建會話（AI 生成失敗）
- **WHEN** 用戶在自由練習模式下創建會話
- **AND** 題目不足，後端嘗試自動生成題目
- **AND** AI 生成失敗（API 錯誤、網絡問題等）
- **THEN** 系統在 AI 懸浮窗中顯示錯誤信息
- **AND** 懸浮窗保持顯示，讓用戶了解失敗原因
- **AND** 用戶可以手動關閉懸浮窗
- **AND** 系統返回友好的錯誤提示，不導致服務崩潰

#### Scenario: 自由練習模式與其他模式體驗一致
- **WHEN** 用戶使用不同的練習模式（自由練習、學校輪次模擬、弱點專項練習）
- **THEN** 所有涉及 AI 調用的模式都必須使用 `executeWithThinking` 包裝
- **AND** 所有模式都必須顯示 AI 懸浮窗（當有 AI 調用時）
- **AND** 所有模式在生成完成後都必須自動跳轉到練習頁面
- **AND** 用戶體驗保持一致
