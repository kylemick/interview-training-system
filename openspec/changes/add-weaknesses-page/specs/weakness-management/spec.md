## ADDED Requirements

### Requirement: 弱點列表展示
係統SHALL提供弱點列表页面，支持多維度筛選、排序和分页。

#### Scenario: 查看弱點列表
- **WHEN** 用户访問 `/weaknesses` 页面
- **THEN** 係統显示所有弱點記錄的列表
- **AND** 每个弱點显示：類別、弱點類型、嚴重程度、狀態、描述、創建時間
- **AND** 列表支持按嚴重程度降序、創建時間降序排序（默认）

#### Scenario: 筛選弱點
- **WHEN** 用户在弱點列表页面使用筛選器
- **THEN** 係統支持按以下維度筛選：
  - 專項類別（七大類別：english-oral, chinese-oral等）
  - 狀態（active/improved/resolved）
  - 嚴重程度（high/medium/low）
  - 弱點類型（vocabulary/grammar/logic/knowledge_gap/confidence/expression）
- **AND** 筛選条件可以組合使用
- **AND** 筛選結果实時更新

#### Scenario: 筛選预设
- **WHEN** 用户點击筛選预设按钮
- **THEN** 係統提供以下预设：
  - "高嚴重度活跃弱點"（severity=high, status=active）
  - "已改善弱點"（status=improved）
  - "已解决弱點"（status=resolved）
  - "全部弱點"（清除所有筛選）
- **AND** 點击预设後自動应用對应筛選条件

#### Scenario: 分页浏览
- **WHEN** 弱點數量超過单页显示限制
- **THEN** 係統提供分页控件
- **AND** 默认每页显示20条記錄
- **AND** 用户可以調整每页显示數量（10/20/50/100）

### Requirement: 弱點详情查看
係統SHALL提供弱點详情页面，展示弱點的完整信息。

#### Scenario: 查看弱點详情
- **WHEN** 用户點击弱點列表中的某个弱點或访問 `/weaknesses/:id`
- **THEN** 係統显示弱點的完整信息：
  - 基本信息：類別、弱點類型、嚴重程度、狀態
  - 描述：弱點详细描述
  - 示例文本：体现弱點的原文片段
  - 改進建議：具体的改進建議
  - 相關話題：相關話題標籤列表
  - 練習历史：已練習次數、最後練習時間
  - 時間信息：創建時間、更新時間
  - 來源信息：識別方式（ai/manual）、來源文本（如有）

#### Scenario: 弱點详情页面操作
- **WHEN** 用户在弱點详情页面
- **THEN** 係統提供以下操作：
  - 更新狀態（active/improved/resolved）
  - 删除弱點（需確认）
  - 生成針對性題目（調用AI生成）
  - 創建訓練計劃（基于弱點生成針對性計劃）
  - 返回列表（導航按钮）

### Requirement: 弱點狀態管理
係統SHALL支持更新弱點的狀態，并显示確认對話框。

#### Scenario: 更新弱點狀態
- **WHEN** 用户在弱點详情页面或列表中選擇更新狀態
- **THEN** 係統显示狀態選擇器（active/improved/resolved）
- **AND** 用户選擇新狀態後，係統显示確认對話框
- **AND** 用户確认後，調用 `PATCH /api/weaknesses/:id/status` 更新狀態
- **AND** 更新成功後显示成功提示并刷新數據

#### Scenario: 批量更新狀態
- **WHEN** 用户在弱點列表中選擇多个弱點并點击"批量更新狀態"
- **THEN** 係統显示狀態選擇器
- **AND** 用户選擇新狀態後，係統显示確认對話框（显示将更新的數量）
- **AND** 用户確认後，批量調用API更新所有選中弱點的狀態
- **AND** 更新完成後显示成功提示（显示成功更新的數量）

### Requirement: 弱點删除
係統SHALL支持删除弱點記錄，并显示確认對話框。

#### Scenario: 删除单个弱點
- **WHEN** 用户在弱點详情页面點击删除按钮
- **THEN** 係統显示確认對話框，提示"確定要删除此弱點記錄吗？"
- **AND** 用户確认後，調用 `DELETE /api/weaknesses/:id` 删除記錄
- **AND** 删除成功後显示成功提示并返回列表页面

#### Scenario: 批量删除弱點
- **WHEN** 用户在弱點列表中選擇多个弱點并點击"批量删除"
- **THEN** 係統显示確认對話框，提示"確定要删除選中的 X 条弱點記錄吗？"
- **AND** 用户確认後，批量調用API删除所有選中弱點
- **AND** 删除完成後显示成功提示（显示成功删除的數量）

### Requirement: 弱點統計展示
係統SHALL在弱點管理页面展示統計信息。

#### Scenario: 显示統計卡片
- **WHEN** 用户访問弱點管理页面
- **THEN** 係統在页面顶部显示統計卡片：
  - 總弱點數
  - 按狀態分布（活跃/已改善/已解决）
  - 按嚴重程度分布（高/中/低）
  - 按類別分布（七大專項類別）
  - 按弱點類型分布（vocabulary/grammar等）
- **AND** 統計數據通過調用 `GET /api/weaknesses/stats/summary` 获取

#### Scenario: 統計卡片交互
- **WHEN** 用户點击統計卡片
- **THEN** 係統可以跳转到對应筛選条件的弱點列表（可選功能）

### Requirement: 弱點趋勢可视化
係統SHALL在弱點管理页面展示趋勢图表。

#### Scenario: 显示趋勢图表
- **WHEN** 用户访問弱點管理页面
- **THEN** 係統显示以下图表：
  - 弱點趋勢折线图：按周統計新增弱點數
  - 弱點類型分布饼图：各類型弱點數量占比
  - 改善率柱狀图：按類型統計改善情况（改善率 = (已改善+已解决)/總數）
  - 高嚴重度弱點趋勢图：按周統計高嚴重度弱點數量
  - 練習效果分析图：練習次數与改善率的關係
- **AND** 图表數據通過調用 `GET /api/weaknesses/stats/trends` 获取
- **AND** 图表使用 ECharts 或 Ant Design Charts 渲染

#### Scenario: 趋勢图表時間范围
- **WHEN** 用户查看趋勢图表
- **THEN** 係統默认显示最近30天的數據
- **AND** 用户可以調整時間范围（7天/30天/90天/全部）

### Requirement: 生成針對性題目
係統SHALL支持根據弱點生成針對性練習題目。

#### Scenario: 为单个弱點生成題目
- **WHEN** 用户在弱點详情页面點击"生成針對性題目"按钮
- **THEN** 係統調用 `POST /api/ai/generate-questions-from-weaknesses`
- **AND** 请求參數包含弱點ID和題目數量（默认5道）
- **AND** 生成成功後显示成功提示，并跳转到題目列表或練習页面

#### Scenario: 批量生成題目
- **WHEN** 用户在弱點列表中選擇多个弱點并點击"批量生成題目"
- **THEN** 係統显示對話框，让用户選擇題目數量（每弱點生成數量）
- **AND** 用户確认後，調用API为所有選中弱點生成題目
- **AND** 生成完成後显示成功提示（显示生成的題目總數）

### Requirement: 導航和菜单集成
係統SHALL在係統導航菜单中添加弱點管理入口。

#### Scenario: 導航菜单入口
- **WHEN** 用户查看係統導航菜单
- **THEN** 菜单中包含"弱點管理"項（使用 WarningOutlined 图標）
- **AND** 點击後跳转到 `/weaknesses` 页面
- **AND** 菜单項在"進度报告"和"设置"之間（或根據邏輯顺序排列）

#### Scenario: 面包屑導航
- **WHEN** 用户在弱點详情页面
- **THEN** 係統显示面包屑導航：首页 > 弱點管理 > 弱點详情
- **AND** 點击"弱點管理"可返回列表页面

### Requirement: 响应式设計
係統SHALL確保弱點管理页面在不同设備上正常显示。

#### Scenario: 桌面端显示
- **WHEN** 用户在桌面浏览器访問弱點管理页面
- **THEN** 列表以表格形式显示，充分利用屏幕空間
- **AND** 統計卡片和图表并排显示

#### Scenario: 移動端显示
- **WHEN** 用户在移動设備访問弱點管理页面
- **THEN** 列表以卡片列表形式显示（或响应式表格）
- **AND** 統計卡片垂直排列
- **AND** 图表自适应屏幕宽度
- **AND** 筛選器以抽屉或折叠面板形式展示

### Requirement: 错误处理和用户反馈
係統SHALL提供适当的错误处理和用户反馈。

#### Scenario: 加载狀態
- **WHEN** 係統正在加载弱點數據
- **THEN** 显示加载動画（Spin組件）
- **AND** 禁用操作按钮

#### Scenario: 空狀態
- **WHEN** 弱點列表为空（无數據或筛選後无結果）
- **THEN** 显示空狀態提示（Empty組件）
- **AND** 提供"清除筛選"或"返回"操作

#### Scenario: 错误处理
- **WHEN** API調用失敗
- **THEN** 显示错误提示（message.error）
- **AND** 错误信息清晰易懂（如"获取弱點列表失敗，请稍後重試"）

#### Scenario: 操作成功反馈
- **WHEN** 用户成功执行操作（更新狀態、删除、生成題目等）
- **THEN** 显示成功提示（message.success）
- **AND** 自動刷新相關數據

### Requirement: 基于弱點創建訓練計劃
係統SHALL支持基于单个弱點使用AI創建針對性的訓練計劃，根據弱點的類別和類型選擇合适的練習類型，并生成提升相關的題目。

#### Scenario: 創建基于弱點的訓練計劃
- **WHEN** 用户在弱點详情页面點击"創建訓練計劃"按钮
- **THEN** 係統显示對話框，让用户输入：
  - 訓練周期（開始日期、結束日期）
  - 每日可用時長（分鐘）
  - 目標學校（可選，從數據庫學校列表選擇）
- **AND** 係統根據弱點的以下信息生成針對性計劃：
  - 專項類別（category）：重點加强该類別
  - 弱點類型（weakness_type）：針對具体問題類型设計練習
  - 嚴重程度（severity）：根據嚴重程度調整訓練强度
  - 改進建議（improvement_suggestions）：纳入計劃建議
  - 相關話題（related_topics）：作为練習重點

#### Scenario: AI生成針對性訓練計劃
- **WHEN** 用户確认創建訓練計劃
- **THEN** 係統調用 `POST /api/plans/from-weakness` API
- **AND** API根據弱點信息生成訓練計劃：
  - 重點分配弱點所属的專項類別（提高该類別占比）
  - 根據弱點類型選擇相应的練習類型和題目類型
  - 生成針對性的每日任務，包含该專項類別的練習
  - 在AI建議中說明如何針對该弱點進行訓練
- **AND** 計劃生成後自動創建并保存到數據庫
- **AND** 为計劃中的每日任務自動生成相關題目（調用題目生成API）

#### Scenario: 訓練計劃生成結果
- **WHEN** 訓練計劃創建成功
- **THEN** 係統显示成功提示，包含：
  - 計劃ID
  - 計劃包含的每日任務數量
  - 重點訓練的專項類別
- **AND** 提供操作選項：
  - 查看訓練計劃（跳转到計劃详情页面）
  - 開始第一个任務（跳转到練習页面）
  - 返回弱點详情

#### Scenario: 計劃中的題目生成
- **WHEN** 基于弱點創建訓練計劃時
- **THEN** 係統为計劃中的每日任務自動生成題目
- **AND** 生成的題目：
  - 属于弱點相關的專項類別
  - 針對弱點的具体類型（如vocabulary類型生成詞汇相關題目）
  - 難度适中，适合改善该弱點
  - 參考弱點的改進建議和相關話題
- **AND** 題目保存到題庫并關聯到對应的每日任務

#### Scenario: 多弱點創建計劃（可選增强）
- **WHEN** 用户在弱點列表中選擇多个弱點并點击"批量創建計劃"
- **THEN** 係統分析所有選中弱點的類別分布
- **AND** 生成综合訓練計劃，重點加强出现频率高的專項類別
- **AND** 在計劃建議中說明如何同時改善多个弱點
