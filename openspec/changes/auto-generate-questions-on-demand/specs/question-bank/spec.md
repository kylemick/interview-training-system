## ADDED Requirements

### Requirement: 按需自動生成題目
係統SHALL在检测到題目缺失時自動生成題目，確保流程不中断。

#### Scenario: 检测題目不足并自動生成
- **WHEN** 係統需要为某个類別選擇題目
- **AND** 查询發现该類別没有可用題目或數量不足
- **THEN** 係統自動調用AI生成題目功能
- **AND** 生成數量根據实际需求計算（至少3題，最多不超過所需數量的2倍）
- **AND** 生成的題目立即保存到數據庫，標注來源为"ai_generated"
- **AND** 生成完成後继续原有流程，對用户透明

#### Scenario: 智能生成參數设置
- **WHEN** 係統自動生成題目時
- **THEN** 根據上下文设置生成參數：
  - category: 從任務或请求中获取
  - difficulty: 默认使用"medium"，後续可根據學生表现調整
  - count: 根據实际需求計算，至少3題
  - school_code: 如果有關聯的訓練計劃，使用計劃的目標學校
  - save: 始终为true，保存到數據庫
- **AND** 生成的題目符合類別語言規范（如english-oral使用英文）

#### Scenario: AI生成失敗時的降级处理
- **WHEN** 係統尝試自動生成題目
- **AND** AI API調用失敗（网络错误、API限制、格式错误等）
- **THEN** 係統記錄错误日志，但不抛出异常導致服務崩溃
- **AND** 尝試使用简化參數重新生成（减少數量、不指定學校）
- **AND** 如果仍然失敗，返回友好的错误信息给用户
- **AND** 错误信息說明題目生成失敗，建議用户稍後重試或手動生成題目
- **AND** 服務继续运行，不影响其他功能

## MODIFIED Requirements

### Requirement: AI生成題目
係統SHALL使用AI生成題目以扩充題庫，支持按需自動生成。

#### Scenario: 按需自動生成題目
- **WHEN** 係統检测到題目缺失需要自動生成
- **THEN** 調用现有的AI生成題目功能
- **AND** 使用上下文信息（類別、目標學校、難度）生成合适的題目
- **AND** 生成的題目立即保存到數據庫
- **AND** 返回生成的題目列表供後续使用
- **AND** 如果生成失敗，提供降级处理，不中断服務
