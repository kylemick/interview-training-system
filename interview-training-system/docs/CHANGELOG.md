# 变更日志

本文檔記錄項目的重要变更和優化。

## [2026-01-25] 页面性能優化

### 概述
本次優化主要解决页面访問慢和刷新失敗的問題，并建立了文檔和测試規范。

### 性能優化

#### 前端優化
- ✅ **API 请求優化**
  - 实现请求去重机制：相同请求在 pending 時不重复發送
  - 实现请求取消机制：組件卸载時自動取消未完成的请求
  - 实现请求缓存：GET 请求缓存 5 分鐘 TTL
  - 添加错误重試机制：网络错误時自動重試 1 次（指數退避）
  - 優化 API 超時设置：從 30 秒降低到 10 秒

- ✅ **React 性能優化**
  - 使用 `useMemo` 缓存計算結果
  - 使用 `useCallback` 缓存回調函數
  - 使用 `React.memo` 優化列表組件
  - 優化 columns 定义，避免每次渲染重新創建

- ✅ **页面優化**
  - Dashboard 页面：并行加载任務、會話、弱點數據
  - Questions 页面：并行加载題目、統計、學校列表
  - 統一使用 API 客户端，移除硬编碼的 URL

#### 後端優化
- ✅ **數據庫查询優化**
  - 查询性能监控：記錄超過 100ms 的慢查询
  - 查询結果缓存：學校列表、統計信息等使用缓存（5 分鐘 TTL）
  - JSON 字段統一解析：在數據庫访問层統一解析，避免重复解析
  - 數據庫索引：已为所有常用查询字段添加索引

- ✅ **路由優化**
  - 學校列表：使用缓存
  - 統計查询：使用缓存
  - JSON 字段解析：統一使用 `parseJsonField` 函數

### 問題修复

- ✅ **修复页面刷新問題**
  - Dashboard 页面刷新後數據正常加载
  - Questions 页面刷新後數據正常加载
  - 所有页面統一使用 API 客户端，解决刷新問題

- ✅ **修复前端访問後端問題**
  - 修复 Vite 代理配置：使用 `127.0.0.1` 替代 `localhost`
  - 統一所有页面的 API 調用，移除硬编碼 URL
  - 修复 API 响应格式处理

### 文檔和規范

- ✅ **建立文檔規范**
  - 創建 `docs/DEVELOPMENT_GUIDE.md`：開發規范文檔
  - 創建 `docs/PERFORMANCE.md`：性能優化文檔
  - 更新 `DEVELOPER-GUIDE.md`：添加性能優化章节

- ✅ **建立测試規范**
  - 創建 `docs/TESTING_GUIDE.md`：测試規范文檔
  - 建立测試覆盖率要求（至少 60%）
  - 創建测試检查清单模板

### 性能目標

- ✅ **前端性能**
  - 页面首次加载時間 < 1 秒（本地环境）
  - 所有页面刷新後能正常加载數據

- ✅ **後端性能**
  - API 响应時間 < 500ms（简单查询）
  - 复杂查询 < 2 秒
  - 慢查询监控（> 100ms）

### 技術债務

- [ ] 为關键 API 端點添加性能测試（可在後续迭代中添加）
- [ ] 运行所有现有测試確保没有破坏性变更（需要手動验证）
- [ ] 手動测試所有主要功能流程（需要手動验证）

### 影响范围

- **前端**：所有页面組件、API 客户端
- **後端**：所有路由、數據庫访問层
- **文檔**：新增開發規范、性能優化、测試規范文檔

### 相關文檔

- [性能優化文檔](./PERFORMANCE.md)
- [開發規范文檔](./DEVELOPMENT_GUIDE.md)
- [测試規范文檔](./TESTING_GUIDE.md)
