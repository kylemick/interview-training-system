# Design: AI思考過程展示功能

## Context

当前係統使用DeepSeek API進行各種AI生成任務（題目、反馈、計劃等），这些任務通常需要10-30秒完成。用户只能看到简单的loading提示，无法了解AI正在做什么。

## Goals / Non-Goals

### Goals
- 在所有AI調用页面展示AI思考過程，提升用户体验
- 让用户了解AI正在处理什么任務，减少等待焦虑
- 展示AI的推理步骤，增加交互透明度
- 保持UI简洁，不干扰主要操作流程

### Non-Goals
- 不要求实现真正的AI推理過程展示（DeepSeek API可能不支持）
- 不要求实现复杂的AI解释功能
- 不要求支持用户与AI思考過程的交互

## Decisions

### Decision 1: 思考步骤生成策略

**選擇**：基于任務類型生成模拟思考步骤

**理由**：
- DeepSeek API可能不支持流式输出或中間思考步骤
- 即使支持，流式输出會增加实现复杂度
- 模拟思考步骤可以基于任務類型生成合理的步骤，用户体验足够好

**实现方式**：
- 为每種AI任務類型定义思考步骤模板
- 在AI調用開始時，根據任務類型生成初始步骤
- 在AI处理過程中，定期更新步骤狀態（如"正在分析..." → "正在生成..." → "正在優化..."）
- 在AI調用完成時，显示最终步骤

**示例思考步骤**：
- 生成題目：["分析題目要求", "搜索相關知識點", "生成題目內容", "验证題目质量", "完成"]
- 生成反馈：["分析學生回答", "評估語言质量", "評估內容深度", "識別弱點", "生成改進建議", "完成"]
- 生成計劃：["分析學生信息", "分析目標學校特點", "制定訓練策略", "生成每日任務", "優化時間分配", "完成"]

### Decision 2: 組件实现方式

**選擇**：創建全局悬浮框組件，使用React Context管理狀態

**理由**：
- 悬浮框可以在所有页面复用
- 全局狀態管理可以統一处理多个AI調用
- 不干扰页面主要布局

**实现细节**：
- 組件位置：固定在页面右下角
- 組件大小：默认宽度300-400px，高度自适应（最大500px）
- 显示時机：当有AI調用時自動显示
- 隐藏時机：AI調用完成或失敗後3秒自動隐藏（或用户手動關闭）
- 可最小化：支持最小化为小图標，點击展開

### Decision 3: 數據傳递方式

**選擇**：通過API响应返回思考步骤，或通過輪询获取

**理由**：
- 如果DeepSeek不支持流式输出，使用輪询方式获取思考步骤
- 如果支持流式输出，使用Server-Sent Events (SSE) 或 WebSocket
- 優先考虑简单实现：在AI調用開始時返回初始步骤，在調用過程中定期更新

**实现方式**：
- 方案A（简单）：AI調用返回包含思考步骤的响应，前端定期輪询更新
- 方案B（進阶）：如果DeepSeek支持流式输出，使用SSE实時推送思考步骤
- 初始实现使用方案A，後续可升级到方案B

### Decision 4: 并發AI調用处理

**選擇**：显示最新的AI調用思考過程，或合并显示多个調用

**理由**：
- 多个AI調用同時進行的情况较少
- 如果出现，優先显示最重要的調用（如用户主動触發的）
- 或者显示所有調用的合并狀態

**实现方式**：
- 使用队列管理多个AI調用
- 显示当前活跃的AI調用思考過程
- 如果用户触發新的AI調用，切换到新的思考過程

## Alternatives Considered

### Alternative 1: 使用真正的AI推理過程
- **優點**：展示真实的AI思考過程，更有教育價值
- **缺點**：需要DeepSeek API支持，实现复杂度高
- **决策**：不采用，因为不確定API支持情况，且模拟步骤已足够

### Alternative 2: 在每个页面单独实现思考展示
- **優點**：可以針對每个页面定制
- **缺點**：代碼重复，維护成本高
- **决策**：不采用，使用全局組件更統一

### Alternative 3: 使用Modal而不是悬浮框
- **優點**：更突出，用户必须關注
- **缺點**：會遮挡主要內容，影响用户体验
- **决策**：不采用，悬浮框更轻量，不干扰操作

## Risks / Trade-offs

### Risk 1: 思考步骤可能不够準確
- **風险**：模拟的思考步骤可能与实际AI处理過程不一致
- **缓解**：基于任務類型设計合理的步骤，確保步骤描述清晰易懂
- **接受度**：即使不完全準確，也能提升用户体验

### Risk 2: 性能影响
- **風险**：思考展示組件可能影响页面性能
- **缓解**：使用React.memo優化組件渲染，避免不必要的更新
- **监控**：测試页面性能，確保无明显影响

### Risk 3: 多并發調用的复杂性
- **風险**：多个AI調用同時進行時，狀態管理可能复杂
- **缓解**：使用队列管理，優先显示用户主動触發的調用
- **接受度**：实际使用中并發調用较少，可以接受简单实现

## Migration Plan

### Phase 1: 基础实现
1. 創建全局思考展示組件
2. 实现基础UI和狀態管理
3. 在1-2个页面集成测試

### Phase 2: 全面集成
1. 在所有AI調用页面集成
2. 優化思考步骤文本
3. 测試各種场景

### Phase 3: 優化和增强
1. 如果DeepSeek支持流式输出，升级到实時展示
2. 優化UI動画和交互
3. 收集用户反馈，持续改進

## Open Questions

1. DeepSeek API是否支持流式输出？需要验证
2. 思考步骤的更新频率应该是多少？（建議：每2-3秒更新一次）
3. 是否需要支持用户自定义思考步骤文本？（暫不需要，使用预设模板即可）
