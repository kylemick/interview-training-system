# Design: AI思考过程展示功能

## Context

当前系统使用DeepSeek API进行各种AI生成任务（题目、反馈、计划等），这些任务通常需要10-30秒完成。用户只能看到简单的loading提示，无法了解AI正在做什么。

## Goals / Non-Goals

### Goals
- 在所有AI调用页面展示AI思考过程，提升用户体验
- 让用户了解AI正在处理什么任务，减少等待焦虑
- 展示AI的推理步骤，增加交互透明度
- 保持UI简洁，不干扰主要操作流程

### Non-Goals
- 不要求实现真正的AI推理过程展示（DeepSeek API可能不支持）
- 不要求实现复杂的AI解释功能
- 不要求支持用户与AI思考过程的交互

## Decisions

### Decision 1: 思考步骤生成策略

**选择**：基于任务类型生成模拟思考步骤

**理由**：
- DeepSeek API可能不支持流式输出或中间思考步骤
- 即使支持，流式输出会增加实现复杂度
- 模拟思考步骤可以基于任务类型生成合理的步骤，用户体验足够好

**实现方式**：
- 为每种AI任务类型定义思考步骤模板
- 在AI调用开始时，根据任务类型生成初始步骤
- 在AI处理过程中，定期更新步骤状态（如"正在分析..." → "正在生成..." → "正在优化..."）
- 在AI调用完成时，显示最终步骤

**示例思考步骤**：
- 生成题目：["分析题目要求", "搜索相关知识点", "生成题目内容", "验证题目质量", "完成"]
- 生成反馈：["分析学生回答", "评估语言质量", "评估内容深度", "识别弱点", "生成改进建议", "完成"]
- 生成计划：["分析学生信息", "分析目标学校特点", "制定训练策略", "生成每日任务", "优化时间分配", "完成"]

### Decision 2: 组件实现方式

**选择**：创建全局悬浮框组件，使用React Context管理状态

**理由**：
- 悬浮框可以在所有页面复用
- 全局状态管理可以统一处理多个AI调用
- 不干扰页面主要布局

**实现细节**：
- 组件位置：固定在页面右下角
- 组件大小：默认宽度300-400px，高度自适应（最大500px）
- 显示时机：当有AI调用时自动显示
- 隐藏时机：AI调用完成或失败后3秒自动隐藏（或用户手动关闭）
- 可最小化：支持最小化为小图标，点击展开

### Decision 3: 数据传递方式

**选择**：通过API响应返回思考步骤，或通过轮询获取

**理由**：
- 如果DeepSeek不支持流式输出，使用轮询方式获取思考步骤
- 如果支持流式输出，使用Server-Sent Events (SSE) 或 WebSocket
- 优先考虑简单实现：在AI调用开始时返回初始步骤，在调用过程中定期更新

**实现方式**：
- 方案A（简单）：AI调用返回包含思考步骤的响应，前端定期轮询更新
- 方案B（进阶）：如果DeepSeek支持流式输出，使用SSE实时推送思考步骤
- 初始实现使用方案A，后续可升级到方案B

### Decision 4: 并发AI调用处理

**选择**：显示最新的AI调用思考过程，或合并显示多个调用

**理由**：
- 多个AI调用同时进行的情况较少
- 如果出现，优先显示最重要的调用（如用户主动触发的）
- 或者显示所有调用的合并状态

**实现方式**：
- 使用队列管理多个AI调用
- 显示当前活跃的AI调用思考过程
- 如果用户触发新的AI调用，切换到新的思考过程

## Alternatives Considered

### Alternative 1: 使用真正的AI推理过程
- **优点**：展示真实的AI思考过程，更有教育价值
- **缺点**：需要DeepSeek API支持，实现复杂度高
- **决策**：不采用，因为不确定API支持情况，且模拟步骤已足够

### Alternative 2: 在每个页面单独实现思考展示
- **优点**：可以针对每个页面定制
- **缺点**：代码重复，维护成本高
- **决策**：不采用，使用全局组件更统一

### Alternative 3: 使用Modal而不是悬浮框
- **优点**：更突出，用户必须关注
- **缺点**：会遮挡主要内容，影响用户体验
- **决策**：不采用，悬浮框更轻量，不干扰操作

## Risks / Trade-offs

### Risk 1: 思考步骤可能不够准确
- **风险**：模拟的思考步骤可能与实际AI处理过程不一致
- **缓解**：基于任务类型设计合理的步骤，确保步骤描述清晰易懂
- **接受度**：即使不完全准确，也能提升用户体验

### Risk 2: 性能影响
- **风险**：思考展示组件可能影响页面性能
- **缓解**：使用React.memo优化组件渲染，避免不必要的更新
- **监控**：测试页面性能，确保无明显影响

### Risk 3: 多并发调用的复杂性
- **风险**：多个AI调用同时进行时，状态管理可能复杂
- **缓解**：使用队列管理，优先显示用户主动触发的调用
- **接受度**：实际使用中并发调用较少，可以接受简单实现

## Migration Plan

### Phase 1: 基础实现
1. 创建全局思考展示组件
2. 实现基础UI和状态管理
3. 在1-2个页面集成测试

### Phase 2: 全面集成
1. 在所有AI调用页面集成
2. 优化思考步骤文本
3. 测试各种场景

### Phase 3: 优化和增强
1. 如果DeepSeek支持流式输出，升级到实时展示
2. 优化UI动画和交互
3. 收集用户反馈，持续改进

## Open Questions

1. DeepSeek API是否支持流式输出？需要验证
2. 思考步骤的更新频率应该是多少？（建议：每2-3秒更新一次）
3. 是否需要支持用户自定义思考步骤文本？（暂不需要，使用预设模板即可）
