# Change: 添加語音输入功能優化答案提交交互

## Why

当前係統中，用户只能通過纯文本输入提交答案，这對于小學生用户來說存在以下問題：

1. **输入效率低**：小學生打字速度慢，手工输入答案耗時较長，影响練習流畅度
2. **表達受限**：文字输入可能限制學生的自然表達，无法充分利用口語表達能力
3. **体验不友好**：對于口語類題目（如英文口語、中文表達），語音输入更符合实际面試场景
4. **多語言支持不足**：係統需要支持中文、英文、粤語三種語言，語音識別可以更好地处理多語言场景

通過添加語音識別功能，學生可以通過說話的方式输入答案，係統自動将語音转换为文本，替代手工输入，提升用户体验和練習效率。

## What Changes

### 核心功能
- **語音输入模式**：在答案输入区域添加語音输入按钮，支持一键启動/停止錄音
- **实時語音識別**：使用浏览器 Web Speech API 進行实時語音转文字
- **多語言支持**：支持中文（普通話）、英文两種語言的語音識別
- **識別結果展示**：实時显示識別結果，支持手動编輯修正
- **输入方式切换**：用户可以在語音输入和文本输入之間自由切换
- **錄音狀態反馈**：提供清晰的錄音狀態指示（錄音中、識別中、識別完成）

### 用户体验增强
- 在答案输入区域添加"🎤 語音输入"按钮，點击後開始錄音
- 錄音過程中显示錄音時長和波形動画，提供视觉反馈
- 識別完成後自動填充到文本输入框，用户可继续编輯
- 支持多次錄音，可以追加或替换已有內容
- 提供語言選擇器，用户可以選擇識別語言（中文/英文）
- 識別错误時支持手動编輯修正

### 技術实现
- **前端**：
  - 使用 **Vosk.js** 進行本地离线語音識別（不使用 Google/Apple 服務）
  - 通過 WebAssembly 在浏览器中运行識別模型
  - 使用 Web Audio API 進行音频采集
  - 創建語音输入組件 `components/VoiceInput.tsx`
  - 在 `pages/Practice/index.tsx` 中集成語音输入功能
  - 添加語言選擇下拉菜单
  - 实现模型加载和缓存机制（IndexedDB）
  - 处理浏览器兼容性和降级方案
- **後端**：
  - 无需修改後端API，語音識別在前端完成，最终仍以文本形式提交
  - 保持现有答案提交流程不变
  - （可選）如果 Vosk 方案不满足需求，可添加讯飞API代理接口作为備選方案

**非BREAKING**：这是新增功能，不影响现有文本输入功能。用户可以選擇使用語音输入或继续使用文本输入。

## Impact

### 影响規范
- **interview-practice** (修改): 扩展文字問答模式，添加語音输入作为替代输入方式

### 影响代碼
- **前端**:
  - `pages/Practice/index.tsx`: 集成語音输入組件，添加語言選擇器
  - `components/VoiceInput.tsx`: 新建語音输入組件（錄音、識別、狀態管理）
  - `utils/speechRecognition.ts`: 新建語音識別工具函數（封装浏览器API，处理兼容性）
  - `App.tsx`: 无需修改（路由不变）
- **後端**:
  - 无需修改（答案仍以文本形式提交）

### 实现狀態
- 📋 **待实现**: 所有功能待開發

## Benefits

1. **提升效率**：語音输入比手工打字快3-5倍，特別适合小學生用户
2. **自然表達**：語音输入更符合口語練習场景，學生可以更自然地組织語言
3. **多語言支持**：支持中文、英文两種語言識別
4. **用户体验**：降低输入门槛，让更多學生能够流畅使用係統
5. **隐私保护**：完全本地处理，語音數據不离開用户设備，符合隐私優先原則
6. **向後兼容**：保留文本输入功能，用户可根據習惯選擇输入方式
7. **离线支持**：模型下载後可在离线环境使用（首次需要网络下载模型）

## Constraints

1. **浏览器兼容性**：
   - 需要支持 WebAssembly 的现代浏览器（Chrome、Edge、Firefox、Safari 等）
   - 不支持 WebAssembly 的舊版浏览器需要降级到文本输入
   - 需要检测浏览器支持情况，不支持的浏览器自動隐藏語音输入按钮

2. **模型文件**：
   - 每種語言的識別模型约50MB，首次使用需要下载
   - 模型文件需要存储在 CDN 或本地服務器
   - 浏览器使用 IndexedDB 缓存模型，避免重复下载
   - 首次加载可能需要等待，需要提供加载進度提示

3. **隐私和數據安全**：
   - **不使用 Google/Apple 語音識別服務**，所有处理在本地完成
   - 語音數據完全在用户设備上处理，不离開浏览器
   - 符合本地部署的隐私優先原則

4. **識別準確性**：
   - 本地識別準確率可能低于云端服務，特別是對于口音、噪音环境
   - 需要提供手動编輯功能，允许用户修正識別错误
   - 如果準確率不满足需求，可考虑切换到讯飞API方案（需要後端支持）

5. **性能考虑**：
   - 在浏览器中运行識別模型可能消耗较多CPU和內存
   - 低端设備可能需要降级到文本输入
   - 需要優化模型加载和运行性能
