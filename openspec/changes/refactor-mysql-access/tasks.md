# 任务清单

## 1. 分析和诊断
- [x] 1.1 分析当前 SQL 参数类型错误的根本原因
- [x] 1.2 检查所有使用 `query()` 函数的地方，识别潜在问题
- [x] 1.3 确认 MySQL2 驱动对参数类型的要求

## 2. 修复核心数据库访问层
- [x] 2.1 在 `db/index.ts` 中添加参数类型验证和转换函数
- [x] 2.2 改进 `query()` 函数，确保参数类型正确
- [x] 2.3 优化日志输出，添加参数类型信息
- [x] 2.4 添加 TypeScript 类型注解，提升类型安全性

## 3. 修复路由层问题
- [x] 3.1 修复 `routes/questions.ts` 中的分页查询参数问题
- [x] 3.2 修复 `routes/schools.ts` 中可能存在的查询问题
- [x] 3.3 统一错误处理逻辑
- [x] 3.4 确保 JSON 字段解析的健壮性

## 4. 建立规范文档
- [x] 4.1 在代码注释中添加 MySQL 查询参数规范
- [x] 4.2 添加查询函数使用示例
- [x] 4.3 文档化常见陷阱和最佳实践

## 5. 测试和验证
- [x] 5.1 测试题库列表 API（`GET /api/questions`）
- [x] 5.2 测试学校列表 API（`GET /api/schools`）
- [x] 5.3 测试分页功能（不同的 limit 和 offset 值）
- [x] 5.4 测试筛选功能（category, difficulty 等）
- [x] 5.5 验证错误场景的处理

## 6. 代码质量
- [x] 6.1 运行 ESLint 检查
- [x] 6.2 确保 TypeScript 编译无错误
- [x] 6.3 检查日志输出是否合理
- [x] 6.4 清理调试代码
