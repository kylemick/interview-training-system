# Design: 修复面试回忆页面并增强问题类型分类

## Context

当前系统存在以下问题：
1. 面试回忆页面因 `SCHOOLS` 未定义导致无法打开
2. 问题类型分类依赖一次性AI识别，缺乏持续优化
3. 分类规则更新时历史数据无法自动关联
4. 无法基于积累数据持续识别训练专项

## Goals / Non-Goals

### Goals
- 修复面试回忆页面，确保正常访问
- 实现AI自动识别问题类型，支持持续学习优化
- 实现定期批量更新分类，确保历史数据一致性
- 基于回忆和反馈持续识别训练专项

### Non-Goals
- 不改变现有的七大专项类别定义
- 不改变现有的题目数据结构（仅增强分类字段）
- 不实现复杂的机器学习模型训练（使用提示词工程优化）

## Decisions

### Decision 1: 修复 SCHOOLS 未定义问题
**方案**：在编辑问题弹窗中使用已从API加载的 `schools` 状态，而不是未定义的 `SCHOOLS` 常量

**理由**：
- 保持与主表单一致的数据源
- 确保学校列表实时更新
- 最小化代码变更

**替代方案**：创建独立的 SCHOOLS 常量（已拒绝，因为需要手动维护）

### Decision 2: AI分类增强策略
**方案**：使用提示词工程增强AI分类准确性，结合历史分类结果进行持续优化

**实现方式**：
1. 在AI提示词中包含历史分类示例和常见误分类模式
2. 定期收集用户手动修正的分类，作为训练样本
3. 使用few-shot learning方式，在提示词中提供正确分类示例

**理由**：
- 无需训练复杂模型，成本低
- 可以快速迭代优化
- 符合当前系统架构

**替代方案**：训练专门的分类模型（已拒绝，因为复杂度高且需要大量标注数据）

### Decision 3: 历史数据关联更新机制
**方案**：使用分类历史表和批量更新API，支持回滚和审计

**实现方式**：
1. 创建 `question_category_history` 表记录每次分类变更
2. 提供批量更新API，支持按规则更新历史数据
3. 更新时同时更新相关表（questions, qa_records, sessions等）

**理由**：
- 保证数据一致性
- 支持审计和回滚
- 不影响现有查询性能

**替代方案**：实时更新（已拒绝，因为可能影响性能）

### Decision 4: 训练专项识别机制
**方案**：基于面试回忆和反馈数据，使用AI分析识别需要加强的专项

**实现方式**：
1. 定期分析面试回忆中的弱点分布
2. 分析反馈数据中的常见问题
3. AI生成专项推荐报告
4. 自动生成针对性训练计划建议

**理由**：
- 充分利用已有数据
- 提供个性化建议
- 持续优化训练效果

## Risks / Trade-offs

### Risk 1: 分类更新影响历史数据准确性
**缓解措施**：
- 保留分类历史记录，支持回滚
- 提供预览功能，用户确认后再更新
- 区分"自动分类"和"手动确认"标记

### Risk 2: 批量更新性能问题
**缓解措施**：
- 使用分批处理，避免长时间锁定
- 在低峰期执行批量更新
- 提供进度跟踪和取消功能

### Risk 3: AI分类准确性不足
**缓解措施**：
- 提供用户手动修正机制
- 收集修正数据持续优化提示词
- 对于不确定分类，标记为"待确认"

## Migration Plan

### Phase 1: 修复页面问题（立即）
1. 修复 `InterviewMemory/index.tsx` 中的 SCHOOLS 未定义
2. 测试页面正常访问和功能

### Phase 2: 增强分类能力（1-2天）
1. 创建分类历史表
2. 增强AI分类提示词
3. 实现分类更新API

### Phase 3: 批量更新机制（2-3天）
1. 实现批量更新逻辑
2. 添加预览和确认功能
3. 测试历史数据更新

### Phase 4: 专项识别功能（2-3天）
1. 实现数据分析API
2. 实现AI专项推荐
3. 集成到训练计划生成流程

### Rollback Plan
- 如果分类更新出现问题，使用历史表回滚
- 如果AI分类准确性下降，回退到之前的提示词版本
- 保留所有原始分类数据，支持完全恢复

## Open Questions

1. 分类更新的频率如何确定？（建议：每周或每月一次）
2. 是否需要用户手动审核所有自动分类？（建议：仅审核不确定分类）
3. 专项识别的推荐如何集成到现有训练计划？（建议：作为建议项，用户确认后应用）
