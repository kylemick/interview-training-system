# Design: 修复面試回憶页面并增强問題類型分類

## Context

当前係統存在以下問題：
1. 面試回憶页面因 `SCHOOLS` 未定义導致无法打開
2. 問題類型分類依赖一次性AI識別，缺乏持续優化
3. 分類規則更新時历史數據无法自動關聯
4. 无法基于积累數據持续識別訓練專項

## Goals / Non-Goals

### Goals
- 修复面試回憶页面，確保正常访問
- 实现AI自動識別問題類型，支持持续學習優化
- 实现定期批量更新分類，確保历史數據一致性
- 基于回憶和反馈持续識別訓練專項

### Non-Goals
- 不改变现有的七大專項類別定义
- 不改变现有的題目數據結构（仅增强分類字段）
- 不实现复杂的机器學習模型訓練（使用提示詞工程優化）

## Decisions

### Decision 1: 修复 SCHOOLS 未定义問題
**方案**：在编輯問題弹窗中使用已從API加载的 `schools` 狀態，而不是未定义的 `SCHOOLS` 常量

**理由**：
- 保持与主表单一致的數據源
- 確保學校列表实時更新
- 最小化代碼变更

**替代方案**：創建独立的 SCHOOLS 常量（已拒绝，因为需要手動維护）

### Decision 2: AI分類增强策略
**方案**：使用提示詞工程增强AI分類準確性，結合历史分類結果進行持续優化

**实现方式**：
1. 在AI提示詞中包含历史分類示例和常见误分類模式
2. 定期收集用户手動修正的分類，作为訓練樣本
3. 使用few-shot learning方式，在提示詞中提供正確分類示例

**理由**：
- 无需訓練复杂模型，成本低
- 可以快速迭代優化
- 符合当前係統架构

**替代方案**：訓練專门的分類模型（已拒绝，因为复杂度高且需要大量標注數據）

### Decision 3: 历史數據關聯更新机制
**方案**：使用分類历史表和批量更新API，支持回滚和审計

**实现方式**：
1. 創建 `question_category_history` 表記錄每次分類变更
2. 提供批量更新API，支持按規則更新历史數據
3. 更新時同時更新相關表（questions, qa_records, sessions等）

**理由**：
- 保证數據一致性
- 支持审計和回滚
- 不影响现有查询性能

**替代方案**：实時更新（已拒绝，因为可能影响性能）

### Decision 4: 訓練專項識別机制
**方案**：基于面試回憶和反馈數據，使用AI分析識別需要加强的專項

**实现方式**：
1. 定期分析面試回憶中的弱點分布
2. 分析反馈數據中的常见問題
3. AI生成專項推荐报告
4. 自動生成針對性訓練計劃建議

**理由**：
- 充分利用已有數據
- 提供个性化建議
- 持续優化訓練效果

## Risks / Trade-offs

### Risk 1: 分類更新影响历史數據準確性
**缓解措施**：
- 保留分類历史記錄，支持回滚
- 提供预览功能，用户確认後再更新
- 区分"自動分類"和"手動確认"標記

### Risk 2: 批量更新性能問題
**缓解措施**：
- 使用分批处理，避免長時間锁定
- 在低峰期执行批量更新
- 提供進度跟踪和取消功能

### Risk 3: AI分類準確性不足
**缓解措施**：
- 提供用户手動修正机制
- 收集修正數據持续優化提示詞
- 對于不確定分類，標記为"待確认"

## Migration Plan

### Phase 1: 修复页面問題（立即）
1. 修复 `InterviewMemory/index.tsx` 中的 SCHOOLS 未定义
2. 测試页面正常访問和功能

### Phase 2: 增强分類能力（1-2天）
1. 創建分類历史表
2. 增强AI分類提示詞
3. 实现分類更新API

### Phase 3: 批量更新机制（2-3天）
1. 实现批量更新邏輯
2. 添加预览和確认功能
3. 测試历史數據更新

### Phase 4: 專項識別功能（2-3天）
1. 实现數據分析API
2. 实现AI專項推荐
3. 集成到訓練計劃生成流程

### Rollback Plan
- 如果分類更新出现問題，使用历史表回滚
- 如果AI分類準確性下降，回退到之前的提示詞版本
- 保留所有原始分類數據，支持完全恢复

## Open Questions

1. 分類更新的频率如何確定？（建議：每周或每月一次）
2. 是否需要用户手動审核所有自動分類？（建議：仅审核不確定分類）
3. 專項識別的推荐如何集成到现有訓練計劃？（建議：作为建議項，用户確认後应用）
