# 任務清单

## 1. 分析和诊断
- [x] 1.1 分析当前 SQL 參數類型错误的根本原因
- [x] 1.2 检查所有使用 `query()` 函數的地方，識別潜在問題
- [x] 1.3 確认 MySQL2 驱動對參數類型的要求

## 2. 修复核心數據庫访問层
- [x] 2.1 在 `db/index.ts` 中添加參數類型验证和转换函數
- [x] 2.2 改進 `query()` 函數，確保參數類型正確
- [x] 2.3 優化日志输出，添加參數類型信息
- [x] 2.4 添加 TypeScript 類型注解，提升類型安全性

## 3. 修复路由层問題
- [x] 3.1 修复 `routes/questions.ts` 中的分页查询參數問題
- [x] 3.2 修复 `routes/schools.ts` 中可能存在的查询問題
- [x] 3.3 統一错误处理邏輯
- [x] 3.4 確保 JSON 字段解析的健壮性

## 4. 建立規范文檔
- [x] 4.1 在代碼注释中添加 MySQL 查询參數規范
- [x] 4.2 添加查询函數使用示例
- [x] 4.3 文檔化常见陷阱和最佳实践

## 5. 测試和验证
- [x] 5.1 测試題庫列表 API（`GET /api/questions`）
- [x] 5.2 测試學校列表 API（`GET /api/schools`）
- [x] 5.3 测試分页功能（不同的 limit 和 offset 值）
- [x] 5.4 测試筛選功能（category, difficulty 等）
- [x] 5.5 验证错误场景的处理

## 6. 代碼质量
- [x] 6.1 运行 ESLint 检查
- [x] 6.2 確保 TypeScript 编译无错误
- [x] 6.3 检查日志输出是否合理
- [x] 6.4 清理調試代碼
