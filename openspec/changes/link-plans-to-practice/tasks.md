# Implementation Tasks

## 1. 后端API增强
- [x] 1.1 创建"获取未完成任务"API (`GET /api/plans/pending-tasks`)
- [x] 1.2 修改"创建会话"API,支持从任务ID创建会话并自动选择题目
- [x] 1.3 修改"完成会话"API,自动标记关联任务为完成
- [x] 1.4 创建"从任务创建会话"专用API (`POST /api/plans/tasks/:taskId/start-practice`)
- [x] 1.5 在会话详情API中返回关联的任务和计划信息

## 2. 数据库Schema调整
- [x] 2.1 确认`sessions.task_id`外键约束正确设置
- [x] 2.2 添加索引优化任务-会话关联查询
- [x] 2.3 编写数据迁移脚本(如果需要)

## 3. 前端Dashboard页面
- [x] 3.1 在Dashboard添加"今日任务"卡片,显示未完成的每日任务列表
- [x] 3.2 为每个任务添加"开始练习"按钮,点击后跳转到练习页面并自动加载题目
- [x] 3.3 显示任务完成进度条
- [x] 3.4 区分"计划内练习"和"自由练习"的统计数据

## 4. 前端训练计划页面
- [x] 4.1 在每日任务卡片上添加"开始"按钮
- [x] 4.2 显示任务状态(待开始/进行中/已完成)
- [x] 4.3 点击"开始"按钮后,跳转到练习页面并传递`taskId`参数

## 5. 前端练习页面重构
- [x] 5.1 支持从URL参数接收`taskId`
- [x] 5.2 如果有`taskId`,自动从任务加载题目,无需用户选择类别
- [x] 5.3 在练习页面顶部显示任务信息横幅(计划名称、日期、类别、进度)
- [x] 5.4 保留"自由练习"入口,允许用户不关联任务进行练习
- [x] 5.5 完成练习后,如果关联了任务,显示"任务已完成"提示

## 6. 练习流程优化
- [x] 6.1 练习完成后,自动调用API标记任务完成
- [x] 6.2 如果有多个未完成任务,完成当前任务后提示"继续下一个任务"
- [x] 6.3 所有任务完成后,显示"今日任务全部完成"庆祝动画
- [x] 6.4 添加"跳过任务"选项(标记为已完成但不练习)

## 7. 用户体验增强
- [ ] 7.1 在侧边栏导航添加任务计数徽章(显示今日未完成任务数)
- [ ] 7.2 练习页面支持"暂停并保存"(关联任务ID)
- [ ] 7.3 重新进入练习页面时,检测是否有未完成的会话,提示恢复
- [ ] 7.4 添加"任务历史"页面,查看过往完成的任务记录
- [x] 7.5 优化任务信息横幅,显示更详细的计划信息(目标学校、学生姓名等)
- [ ] 7.6 添加任务完成统计卡片(今日完成数、总时长、平均分等)

## 8. 错误处理和边界情况
- [x] 8.1 处理任务不存在的情况(404错误)
- [x] 8.2 处理题目数量不足的情况(返回错误提示)
- [x] 8.3 处理任务已有未完成会话的情况(自动返回现有会话,前端显示"继续练习")
- [ ] 8.4 处理网络错误时的重试机制
- [ ] 8.5 处理会话创建失败时的回滚逻辑

## 9. 测试
- [ ] 9.1 单元测试: 测试任务-会话关联逻辑
- [ ] 9.2 集成测试: 创建计划→开始任务→完成练习→任务标记完成
- [ ] 9.3 边界测试: 无计划时"自由练习"模式
- [ ] 9.4 UI测试: Dashboard和训练计划页面交互
- [ ] 9.5 手动测试: 完整用户流程体验
- [ ] 9.6 性能测试: 大量任务时的查询性能

## Validation Criteria

### 核心功能验证
每个任务完成后需验证:
- ✅ API返回正确的任务和会话关联数据
- ✅ 前端正确显示任务信息和状态
- ✅ 完成练习后,任务状态自动更新
- ✅ "自由练习"模式不受影响,可以独立使用
- ✅ 错误处理到位(任务不存在、会话创建失败等)

### 完整流程验证
- ✅ 创建训练计划→查看Dashboard今日任务→开始任务练习→完成练习→任务自动标记完成
- ✅ 所有任务完成后,Dashboard显示"今日无待办任务"或庆祝提示
- ✅ 无计划时,仍可进入"自由练习"模式
- ✅ 任务状态和进度条实时更新
- ✅ 任务完成后智能引导(继续下一个或庆祝全部完成)

### 待验证功能
- [ ] 任务跳过功能正常工作
- [ ] 任务恢复功能(如果实现)
- [ ] 导航栏任务徽章实时更新
- [ ] 统计数据正确区分计划内和自由练习

## 后续优化建议

### 短期优化(1-2周)
1. **实现任务跳过功能**: 允许用户直接标记任务完成而不练习
2. **添加导航栏徽章**: 在侧边栏显示今日未完成任务数,提升可见性
3. **优化错误提示**: 更友好的错误消息和重试机制

### 中期优化(1个月)
1. **任务恢复功能**: 支持暂停后继续未完成的会话
2. **统计数据区分**: Dashboard分别显示计划内和自由练习的统计
3. **任务历史页面**: 查看过往完成的任务记录和趋势

### 长期优化(3个月+)
1. **智能推荐**: 根据完成情况推荐下一个任务
2. **任务依赖**: 支持任务之间的依赖关系
3. **进度分析**: 深度分析任务完成情况和训练效果
