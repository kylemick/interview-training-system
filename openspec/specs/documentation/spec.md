# Capability: Documentation (項目文檔管理)

## Purpose

項目文檔管理能力確保項目文檔（`openspec/project.md`）与代碼实现保持同步，準確反映当前的技術栈、項目結构、功能模块和能力列表。该能力定义了文檔更新的標準流程、检查清单和準確性要求，帮助開發者快速了解項目当前狀態和已实现功能。

## Requirements

### Requirement: 項目文檔完整性要求
係統SHALL維护準確、完整的項目文檔，反映当前实现狀態。

#### Scenario: 文檔与代碼同步
- **WHEN** 代碼实现發生变化（新增功能、修改架构、更新技術栈）
- **THEN** 項目文檔（`openspec/project.md`）应在变更完成後及時更新
- **AND** 文檔应準確反映当前的技術栈、項目結构、功能模块和能力列表
- **AND** 文檔更新应作为变更实施的一部分，在任務清单中明確標注

#### Scenario: 文檔审查检查清单
- **WHEN** 更新項目文檔時
- **THEN** 应检查以下內容是否準確：
  - 技術栈版本和依赖
  - 項目目錄結构
  - 已实现的功能模块列表
  - 已归檔的能力列表
  - 開發規范和约束条件（包括AI調用超時規范、前端組件使用規范、繁體中文規範等）
  - API端點列表（如适用）
  - 數據庫表結构概览（如适用）

### Requirement: 能力狀態追踪
係統SHALL在項目文檔中明確列出所有能力及其实现狀態。

#### Scenario: 列出已归檔能力
- **WHEN** 查看項目文檔的能力列表
- **THEN** 应列出所有已归檔到 `openspec/specs/` 的能力
- **AND** 每个能力应標注其狀態（已实现、部分实现、待实现）
- **AND** 应提供到對应spec文件的链接或路径

#### Scenario: 列出待归檔能力
- **WHEN** 查看項目文檔的能力列表
- **THEN** 应列出所有在变更中定义但尚未归檔的能力
- **AND** 应標注其來源变更ID和当前狀態
- **AND** 应說明归檔計劃或待办事項

### Requirement: 文檔更新流程
係統SHALL定义文檔更新的標準流程，確保文檔与代碼保持同步。

#### Scenario: 变更实施時更新文檔
- **WHEN** 实施一个变更（change）時
- **THEN** 如果变更影响項目文檔內容（技術栈、結构、能力等）
- **AND** 应在 `tasks.md` 中包含文檔更新任務
- **AND** 文檔更新应在变更归檔前完成
- **AND** 文檔更新应通過代碼审查验证

#### Scenario: 定期文檔审查
- **WHEN** 項目進行重大里程碑或發布前
- **THEN** 应進行全面的文檔审查
- **AND** 验证文檔与代碼实现的一致性
- **AND** 更新過時的信息
- **AND** 补充缺失的說明

### Requirement: 技術栈文檔準確性
係統SHALL在項目文檔中準確記錄实际使用的技術栈和版本。

#### Scenario: 技術栈版本更新
- **WHEN** 項目依赖或技術栈版本發生变化
- **THEN** 項目文檔中的技術栈部分应及時更新
- **AND** 应記錄版本號（如 React 18+, Node.js 18+）
- **AND** 应說明版本要求的原因（如兼容性、功能需求）

#### Scenario: 新增技術依赖
- **WHEN** 項目引入新的技術依赖或工具
- **THEN** 項目文檔应更新技術栈列表
- **AND** 应說明新技術的用途和選擇理由
- **AND** 应在"外部依赖"部分說明安装和配置要求

### Requirement: 項目結构文檔準確性
係統SHALL在項目文檔中準確描述項目的目錄結构和組织方式。

#### Scenario: 目錄結构变更
- **WHEN** 項目目錄結构發生变化（新增目錄、重組文件）
- **THEN** 項目文檔中的"項目結构"部分应及時更新
- **AND** 应說明主要目錄的用途和內容
- **AND** 应標注關键文件的位置

#### Scenario: 模块組织說明
- **WHEN** 查看項目結构文檔
- **THEN** 应能理解項目的模块化組织方式
- **AND** 应了解前後端分离的架构
- **AND** 应了解OpenSpec規范的組织方式

## ADDED Requirements

### Requirement: AI調用超時規范文檔要求
係統SHALL在項目文檔中明確記錄AI調用的超時規范，確保所有AI相關接口遵循无超時限制的要求。

#### Scenario: AI調用超時規范記錄
- **WHEN** 查看項目文檔的约束条件部分
- **THEN** 应明確說明所有AI調用接口必须设置 `timeout: 0`（无超時限制）
- **AND** 应列出需要遵循此規范的所有AI相關接口類型
- **AND** 应提供後端和前端的具体实现示例
- **AND** 应說明原因（AI处理可能需要较長時間，不应因超時而中断）

#### Scenario: AI調用超時規范检查
- **WHEN** 实施涉及AI調用的变更時
- **THEN** 应在文檔审查检查清单中验证新接口是否遵循超時規范
- **AND** 应在代碼审查中检查AI接口的超時设置
- **AND** 应在任務清单中明確標注需要遵循此規范

### Requirement: 前端通用組件規范文檔要求
係統SHALL在項目文檔中明確記錄前端AI交互組件的使用規范，確保所有AI調用页面使用統一的悬浮框組件。

#### Scenario: 前端組件規范記錄
- **WHEN** 查看項目文檔的约束条件部分
- **THEN** 应明確說明所有AI調用页面必须使用通用悬浮框組件（`AiThinkingDisplay`）
- **AND** 应說明組件的位置和用法（`frontend/src/components/AiThinkingDisplay/`）
- **AND** 应列出需要使用此組件的所有页面類型
- **AND** 应說明原因（保持用户体验一致性，避免各自实现不同的loading提示）

#### Scenario: 前端組件規范检查
- **WHEN** 实施涉及AI調用的前端页面变更時
- **THEN** 应在文檔审查检查清单中验证新页面是否使用通用悬浮框組件
- **AND** 应在代碼审查中检查AI調用页面是否集成 `AiThinkingDisplay` 組件
- **AND** 应在任務清单中明確標注需要使用通用組件

### Requirement: 繁體中文規範文檔要求
係統SHALL在項目文檔中明確記錄繁體中文規範，確保所有中文內容使用繁體中文。

#### Scenario: 繁體中文規範記錄
- **WHEN** 查看項目文檔的約束條件部分
- **THEN** 應明確說明所有中文內容必須使用繁體中文，禁止使用簡體中文
- **AND** 應列出需要遵循此規範的所有內容類型（代碼註釋、文檔、用戶界面文字、錯誤消息、AI生成內容等）
- **AND** 應明確說明 OpenSpec 目錄（`openspec/`）下的所有文件必須使用繁體中文，包括規範文件、變更提案、任務清單等
- **AND** 應明確說明所有 AI 提示詞必須包含語言規範要求（除英文專項外必須使用繁體中文）
- **AND** 應說明例外情況（英文專項的內容保持英文）
- **AND** 應說明原因（項目目標用戶是香港小學生，使用繁體中文符合本地使用習慣）

#### Scenario: 繁體中文規範檢查
- **WHEN** 更新項目文檔時
- **THEN** 應在文檔審查檢查清單中包含語言規範檢查
- **AND** 應驗證所有中文內容是否使用繁體中文
- **AND** 應特別檢查 OpenSpec 目錄下的文件是否使用繁體中文
- **AND** 應在代碼審查中檢查新添加的中文內容是否符合規範
- **AND** 應在代碼審查中檢查所有 AI 提示詞是否包含語言規範要求
- **AND** 應在任務清單中明確標注需要遵循語言規範

#### Scenario: OpenSpec 文件語言規範
- **WHEN** 創建或更新 OpenSpec 目錄下的文件時
- **THEN** 所有文件內容必須使用繁體中文，包括：
  - `openspec/project.md`、`openspec/AGENTS.md` 等核心文檔
  - `openspec/specs/` 目錄下的所有規範文件（spec.md）
  - `openspec/changes/` 目錄下的所有變更提案（proposal.md）、任務清單（tasks.md）、設計文檔（design.md）等
- **AND** 應在文檔審查時驗證 OpenSpec 文件是否使用繁體中文
- **AND** 應在變更提案的任務清單中明確標注需要遵循語言規範

#### Scenario: AI 提示詞語言規範檢查
- **WHEN** 實施涉及 AI 調用的變更時
- **THEN** 應在代碼審查中檢查所有 AI 提示詞是否包含語言規範要求
- **AND** 應驗證英文專項（english-oral, english-reading）的提示詞是否明確要求返回英文
- **AND** 應驗證其他類別的提示詞是否在開頭明確指定「必須使用繁體中文」
- **AND** 應檢查所有 AI 服務文件（`backend/src/ai/*.ts`）中的提示詞
- **AND** 應檢查所有路由文件（`backend/src/routes/*.ts`）中直接調用 AI 的地方
- **AND** 應在任務清單中明確標注需要遵循 AI 提示詞語言規範
