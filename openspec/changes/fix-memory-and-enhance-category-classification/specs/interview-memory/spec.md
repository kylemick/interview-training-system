# Interview Memory Capability

## ADDED Requirements

### Requirement: 面试回忆页面正常访问
系统SHALL确保面试回忆页面可以正常打开和访问，所有功能正常工作。

#### Scenario: 页面正常加载
- **WHEN** 用户访问 `/memory` 路由
- **THEN** 页面正常渲染，不出现未定义变量错误
- **AND** 所有表单控件正常显示
- **AND** 学校下拉列表从API动态加载

#### Scenario: 编辑问题弹窗正常显示
- **WHEN** 用户点击编辑问题按钮
- **THEN** 编辑弹窗正常打开
- **AND** 学校下拉列表显示从数据库获取的学校列表
- **AND** 所有字段可以正常编辑和保存

### Requirement: AI自动识别问题类型
系统SHALL使用AI自动识别面试回忆中的问题类型，并支持持续优化分类准确性。

#### Scenario: AI自动分类问题
- **WHEN** 用户提交面试回忆文本进行AI分析
- **THEN** AI自动识别每个问题的专项类别（七大类别之一）
- **AND** 分类结果准确率应达到85%以上
- **AND** 对于不确定的分类，标记为"待确认"

#### Scenario: 基于历史数据优化分类
- **WHEN** 系统积累了用户手动修正的分类数据
- **THEN** AI提示词中包含这些修正示例
- **AND** 后续分类准确性持续提升
- **AND** 常见误分类模式被识别和纠正

#### Scenario: 分类置信度标记
- **WHEN** AI进行问题分类
- **THEN** 每个分类结果包含置信度分数（0-1）
- **AND** 置信度低于0.7的分类标记为"待确认"
- **AND** 用户可以在界面上查看和修正低置信度分类

### Requirement: 定期更新归纳问题类型
系统SHALL支持定期批量更新问题类型分类，确保历史数据与新分类规则保持一致。

#### Scenario: 触发分类更新
- **WHEN** 管理员或系统触发分类更新任务
- **THEN** 系统分析所有历史题目和面试回忆
- **AND** 使用最新的分类规则重新分类
- **AND** 生成更新预览报告，显示变更统计

#### Scenario: 批量更新历史数据
- **WHEN** 用户确认执行分类更新
- **THEN** 系统批量更新所有相关数据表（questions, qa_records, sessions等）
- **AND** 记录每次分类变更到历史表
- **AND** 更新完成后显示更新统计（更新数量、影响范围）

#### Scenario: 分类更新回滚
- **WHEN** 用户发现分类更新有误
- **THEN** 系统支持回滚到更新前的分类状态
- **AND** 使用分类历史表恢复原始分类
- **AND** 回滚操作记录到日志

### Requirement: 历史数据关联更新
系统SHALL在分类规则更新时，自动更新所有相关历史记录，确保数据一致性。

#### Scenario: 题目分类更新
- **WHEN** 问题类型分类规则更新
- **THEN** 系统更新 `questions` 表中所有相关题目的 `category` 字段
- **AND** 更新 `question_category_history` 表记录变更历史
- **AND** 保留原始分类信息用于审计

#### Scenario: 会话记录关联更新
- **WHEN** 题目分类更新
- **THEN** 系统检查所有使用该题目的会话记录
- **AND** 更新会话的类别统计信息
- **AND** 更新相关的反馈和弱点分析记录

#### Scenario: 反馈数据关联更新
- **WHEN** 题目分类更新
- **THEN** 系统更新所有相关反馈记录的类别信息
- **AND** 重新计算类别维度的统计指标
- **AND** 更新弱点分析中的类别分布

### Requirement: 持续识别训练专项
系统SHALL基于面试回忆和反馈数据，持续识别学生需要加强的训练专项。

#### Scenario: 分析面试回忆弱点
- **WHEN** 系统积累了多份面试回忆数据
- **THEN** AI分析所有回忆中的弱点分布
- **AND** 识别出现频率最高的弱点类型
- **AND** 识别需要加强的专项类别

#### Scenario: 分析反馈数据模式
- **WHEN** 系统积累了大量练习反馈数据
- **THEN** AI分析反馈中的常见问题模式
- **AND** 识别跨多个会话的持续弱点
- **AND** 识别特定专项的薄弱环节

#### Scenario: 生成专项推荐
- **WHEN** 系统完成数据分析和专项识别
- **THEN** 生成训练专项推荐报告
- **AND** 按优先级排序需要加强的专项
- **AND** 为每个专项提供具体的改进建议
- **AND** 自动生成针对性训练计划建议

#### Scenario: 集成到训练计划
- **WHEN** 用户创建新的训练计划
- **THEN** 系统自动应用专项推荐结果
- **AND** 在计划中增加推荐专项的练习比重
- **AND** 生成针对性的每日任务安排
