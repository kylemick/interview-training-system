# Implementation Tasks

## 1. 前端路由和导航
- [x] 1.1 在 `App.tsx` 中添加 `/weaknesses` 和 `/weaknesses/:id` 路由
- [x] 1.2 在 `components/Layout.tsx` 中添加弱点管理菜单项（使用 WarningOutlined 图标）
- [x] 1.3 导入 Weaknesses 页面组件

## 2. 弱点列表页面
- [x] 2.1 创建 `pages/Weaknesses/index.tsx` 文件
- [x] 2.2 实现弱点列表数据获取（调用 `api.weaknesses.list()`）
- [x] 2.3 实现筛选功能（类别、状态、严重程度、弱点类型）
- [x] 2.4 实现排序功能（按创建时间、严重程度、练习次数等）
- [x] 2.5 实现分页功能
- [x] 2.6 实现表格视图（使用 Ant Design Table）
- [ ] 2.7 实现卡片视图（可选，使用 Ant Design Card）
- [x] 2.8 添加筛选预设按钮（高严重度活跃、已改善、全部等）
- [x] 2.9 实现批量选择功能
- [x] 2.10 实现批量操作（更新状态、删除、生成题目）

## 3. 弱点统计卡片
- [x] 3.1 调用 `api.weaknesses.stats()` 获取统计数据
- [x] 3.2 显示总弱点数统计卡片
- [x] 3.3 显示按状态分布统计（活跃/已改善/已解决）
- [x] 3.4 显示按严重程度分布统计（高/中/低）
- [ ] 3.5 显示按类别分布统计（七大专项类别）
- [ ] 3.6 显示按弱点类型分布统计（vocabulary/grammar/logic等）

## 4. 弱点可视化
- [ ] 4.1 调用 `api.weaknesses.trends()` 获取趋势数据
- [ ] 4.2 实现弱点趋势折线图（按周统计新增弱点数）
- [ ] 4.3 实现弱点类型分布饼图
- [ ] 4.4 实现改善率柱状图（按类型统计改善情况）
- [ ] 4.5 实现高严重度弱点趋势图
- [ ] 4.6 实现练习效果分析图（练习次数与改善率关系）

## 5. 弱点详情页面
- [x] 5.1 实现详情页面路由（`/weaknesses/:id`）
- [x] 5.2 调用 `api.weaknesses.get(id)` 获取弱点详情
- [x] 5.3 显示弱点基本信息（类别、类型、严重程度、状态）
- [x] 5.4 显示弱点描述和示例文本
- [x] 5.5 显示改进建议
- [x] 5.6 显示相关话题标签
- [x] 5.7 显示练习历史（练习次数、最后练习时间）
- [x] 5.8 显示创建时间和更新时间
- [x] 5.9 实现状态更新功能（下拉选择器 + 确认对话框）
- [x] 5.10 实现删除功能（确认对话框）
- [ ] 5.11 实现编辑功能（编辑描述和改进建议，可选）
- [x] 5.12 实现"生成针对性题目"按钮（调用 `api.weaknesses.generateQuestions()`）
- [x] 5.13 实现"创建训练计划"按钮（调用 `api.plans.createFromWeakness()`）
- [x] 5.14 实现创建计划对话框（输入训练周期、每日时长、目标学校）

## 6. 弱点类型和状态映射
- [x] 6.1 定义弱点类型中文映射（vocabulary → 词汇量不足等）
- [x] 6.2 定义严重程度颜色映射（high → 红色等）
- [x] 6.3 定义状态颜色映射（active → 橙色等）
- [x] 6.4 定义专项类别中文映射（复用现有 CATEGORY_MAP）

## 7. 用户体验优化
- [x] 7.1 添加加载状态（Spin组件）
- [x] 7.2 添加空状态提示（Empty组件）
- [x] 7.3 添加错误处理（API调用失败提示）
- [x] 7.4 实现操作成功提示（使用 message.success）
- [x] 7.5 实现操作确认对话框（状态更新、删除等）
- [x] 7.6 优化列表项样式，突出重要信息（严重程度、状态）
- [x] 7.7 添加快速操作按钮（生成题目、查看详情、编辑状态）

## 8. 响应式设计
- [ ] 8.1 确保列表页面在移动端正常显示
- [ ] 8.2 确保详情页面在移动端正常显示
- [ ] 8.3 优化表格在小屏幕上的显示（使用响应式列）

## 9. 测试和验证
- [ ] 9.1 测试弱点列表加载和筛选功能
- [ ] 9.2 测试弱点详情查看功能
- [ ] 9.3 测试状态更新功能
- [ ] 9.4 测试删除功能
- [ ] 9.5 测试批量操作功能
- [ ] 9.6 测试生成针对性题目功能
- [ ] 9.7 测试统计和可视化数据展示
- [ ] 9.8 验证页面性能（加载速度、渲染性能）

## 10. 基于弱点创建训练计划（后端）
- [x] 10.1 在 `routes/plans.ts` 中新增 `POST /api/plans/from-weakness` 路由
- [x] 10.2 实现路由处理逻辑：
  - 接收弱点ID、训练周期、每日时长、目标学校等参数
  - 获取弱点详细信息
  - 调用AI生成针对性训练计划
  - 保存计划到数据库
  - 为每日任务生成相关题目（预留接口）
- [x] 10.3 在 `ai/trainingPlanner.ts` 中新增 `generateTrainingPlanFromWeakness()` 函数
- [x] 10.4 实现AI提示词设计：
  - 包含弱点详细信息（类别、类型、严重程度、描述、改进建议）
  - 重点加强弱点所属专项类别
  - 根据弱点类型选择练习类型
  - 生成针对性的每日任务和AI建议
- [ ] 10.5 实现计划生成后的题目自动生成：
  - 为每日任务调用题目生成API
  - 题目类别匹配弱点类别
  - 题目难度和内容针对弱点类型
- [x] 10.6 添加错误处理和降级方案（AI失败时使用模板）

## 11. 基于弱点创建训练计划（前端）
- [x] 11.1 在 `utils/api.ts` 中添加 `plans.createFromWeakness()` API方法
- [x] 11.2 在弱点详情页面添加"创建训练计划"按钮
- [x] 11.3 实现创建计划对话框：
  - 日期选择器（开始日期、结束日期）
  - 每日时长输入
  - 目标学校下拉选择（从数据库获取）
  - 显示弱点信息预览
- [x] 11.4 实现计划创建流程：
  - 显示加载状态
  - 调用API创建计划
  - 显示成功提示和计划信息
  - 提供跳转到计划详情或开始任务的选项
- [x] 11.5 处理创建失败情况（显示错误提示）

## 12. 测试和验证
- [x] 12.1 测试弱点列表加载和筛选功能（编译测试通过）
- [x] 12.2 测试弱点详情查看功能（编译测试通过）
- [x] 12.3 测试状态更新功能（编译测试通过）
- [x] 12.4 测试删除功能（编译测试通过）
- [x] 12.5 测试批量操作功能（编译测试通过）
- [x] 12.6 测试生成针对性题目功能（编译测试通过）
- [x] 12.7 测试基于弱点创建训练计划功能（编译测试通过）
- [ ] 12.8 测试统计和可视化数据展示（待手动测试）
- [ ] 12.9 验证页面性能（加载速度、渲染性能）（待手动测试）
- [x] 12.10 兼容性测试：所有存量页面验证通过

## 13. 文档更新
- [x] 13.1 更新前端页面结构文档（已创建测试报告）
- [ ] 13.2 更新API文档（新增基于弱点创建计划的接口）
- [ ] 13.3 更新用户使用指南（如有）
- [x] 13.4 在项目文档中记录新页面功能（已创建测试报告）

## 14. 学生信息统一从设置获取（修正）
- [x] 14.1 修正后端API：统一从设置获取学生信息
  - [x] plans.ts: 创建训练计划API
  - [x] plans.ts: 基于弱点创建计划API
  - [x] ai.ts: 保存弱点API
  - [x] weaknesses.ts: 查询弱点API（自动从设置获取）
- [x] 14.2 修正前端：统一使用设置中的学生信息
  - [x] Weaknesses页面：创建计划时从设置获取
  - [x] TrainingPlan页面：创建计划时从设置获取
  - [x] InterviewMemory页面：保存弱点时不传递student_name
- [x] 14.3 创建数据迁移脚本：更新历史数据
- [ ] 14.4 运行数据迁移脚本更新历史数据（需要手动执行）
