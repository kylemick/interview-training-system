# Interview Memory Capability

## ADDED Requirements

### Requirement: 面試回憶页面正常访問
係統SHALL確保面試回憶页面可以正常打開和访問，所有功能正常工作。

#### Scenario: 页面正常加载
- **WHEN** 用户访問 `/memory` 路由
- **THEN** 页面正常渲染，不出现未定义变量错误
- **AND** 所有表单控件正常显示
- **AND** 學校下拉列表從API動態加载

#### Scenario: 编輯問題弹窗正常显示
- **WHEN** 用户點击编輯問題按钮
- **THEN** 编輯弹窗正常打開
- **AND** 學校下拉列表显示從數據庫获取的學校列表
- **AND** 所有字段可以正常编輯和保存

### Requirement: AI自動識別問題類型
係統SHALL使用AI自動識別面試回憶中的問題類型，并支持持续優化分類準確性。

#### Scenario: AI自動分類問題
- **WHEN** 用户提交面試回憶文本進行AI分析
- **THEN** AI自動識別每个問題的專項類別（七大類別之一）
- **AND** 分類結果準確率应達到85%以上
- **AND** 對于不確定的分類，標記为"待確认"

#### Scenario: 基于历史數據優化分類
- **WHEN** 係統积累了用户手動修正的分類數據
- **THEN** AI提示詞中包含这些修正示例
- **AND** 後续分類準確性持续提升
- **AND** 常见误分類模式被識別和纠正

#### Scenario: 分類置信度標記
- **WHEN** AI進行問題分類
- **THEN** 每个分類結果包含置信度分數（0-1）
- **AND** 置信度低于0.7的分類標記为"待確认"
- **AND** 用户可以在界面上查看和修正低置信度分類

### Requirement: 定期更新归纳問題類型
係統SHALL支持定期批量更新問題類型分類，確保历史數據与新分類規則保持一致。

#### Scenario: 触發分類更新
- **WHEN** 管理员或係統触發分類更新任務
- **THEN** 係統分析所有历史題目和面試回憶
- **AND** 使用最新的分類規則重新分類
- **AND** 生成更新预览报告，显示变更統計

#### Scenario: 批量更新历史數據
- **WHEN** 用户確认执行分類更新
- **THEN** 係統批量更新所有相關數據表（questions, qa_records, sessions等）
- **AND** 記錄每次分類变更到历史表
- **AND** 更新完成後显示更新統計（更新數量、影响范围）

#### Scenario: 分類更新回滚
- **WHEN** 用户發现分類更新有误
- **THEN** 係統支持回滚到更新前的分類狀態
- **AND** 使用分類历史表恢复原始分類
- **AND** 回滚操作記錄到日志

### Requirement: 历史數據關聯更新
係統SHALL在分類規則更新時，自動更新所有相關历史記錄，確保數據一致性。

#### Scenario: 題目分類更新
- **WHEN** 問題類型分類規則更新
- **THEN** 係統更新 `questions` 表中所有相關題目的 `category` 字段
- **AND** 更新 `question_category_history` 表記錄变更历史
- **AND** 保留原始分類信息用于审計

#### Scenario: 會話記錄關聯更新
- **WHEN** 題目分類更新
- **THEN** 係統检查所有使用该題目的會話記錄
- **AND** 更新會話的類別統計信息
- **AND** 更新相關的反馈和弱點分析記錄

#### Scenario: 反馈數據關聯更新
- **WHEN** 題目分類更新
- **THEN** 係統更新所有相關反馈記錄的類別信息
- **AND** 重新計算類別維度的統計指標
- **AND** 更新弱點分析中的類別分布

### Requirement: 持续識別訓練專項
係統SHALL基于面試回憶和反馈數據，持续識別學生需要加强的訓練專項。

#### Scenario: 分析面試回憶弱點
- **WHEN** 係統积累了多份面試回憶數據
- **THEN** AI分析所有回憶中的弱點分布
- **AND** 識別出现频率最高的弱點類型
- **AND** 識別需要加强的專項類別

#### Scenario: 分析反馈數據模式
- **WHEN** 係統积累了大量練習反馈數據
- **THEN** AI分析反馈中的常见問題模式
- **AND** 識別跨多个會話的持续弱點
- **AND** 識別特定專項的薄弱环节

#### Scenario: 生成專項推荐
- **WHEN** 係統完成數據分析和專項識別
- **THEN** 生成訓練專項推荐报告
- **AND** 按優先级排序需要加强的專項
- **AND** 为每个專項提供具体的改進建議
- **AND** 自動生成針對性訓練計劃建議

#### Scenario: 集成到訓練計劃
- **WHEN** 用户創建新的訓練計劃
- **THEN** 係統自動应用專項推荐結果
- **AND** 在計劃中增加推荐專項的練習比重
- **AND** 生成針對性的每日任務安排
