## 1. 修复模型路径配置

- [x] 1.1 修复 `LANGUAGE_MODEL_PATHS` 配置
  - 位置：`frontend/src/utils/voskRecognition.ts:29-32`
  - 将路径从 `.tar.gz` 文件改为解压后的目录路径
  - 中文模型：`/models/vosk-model-small-cn-0.22`（去掉 `.tar.gz`）
  - 英文模型：`/models/vosk-model-small-en-us-0.22`（去掉 `.tar.gz`）

- [x] 1.2 更新 `VOICE_INPUT_SETUP.md` 文档
  - 确保文档中的路径说明与代码一致
  - 明确说明模型应该是解压后的目录，不是 `.tar.gz` 文件

## 2. 添加模型文件存在性检查

- [x] 2.1 实现模型文件检查函数
  - 位置：`frontend/src/utils/voskRecognition.ts`
  - 创建 `checkModelFileExists` 函数，检查模型文件是否存在
  - 使用 `fetch` 请求模型目录下的关键文件（如 `am/final.mdl` 或 `graph/HCLr.fst`）
  - 返回检查结果和详细错误信息

- [x] 2.2 在模型加载前进行检查
  - 在 `VoskModelLoader.loadModel` 中，加载模型前先检查文件是否存在
  - 如果文件不存在，抛出清晰的错误信息，包含：
    - 模型文件路径
    - 下载链接或配置说明
    - 如何正确配置模型的步骤

## 3. 改进错误处理和用户提示

- [x] 3.1 增强 `VoskError` 错误类型
  - 添加错误代码枚举，区分不同类型的错误：
    - `MODEL_FILE_NOT_FOUND`: 模型文件不存在
    - `MODEL_LOAD_NETWORK_ERROR`: 网络错误
    - `MODEL_LOAD_FORMAT_ERROR`: 模型格式错误
    - `MODEL_LOAD_PERMISSION_ERROR`: 权限错误
    - `MODULE_NOT_FOUND`: 依赖包未安装
    - `WASM_NOT_SUPPORTED`: WebAssembly 不支持

- [x] 3.2 改进错误消息
  - 为每种错误类型提供详细的中文错误消息
  - 包含具体的解决方案和操作步骤
  - 提供相关文档链接

- [x] 3.3 在 `VoiceInput` 组件中显示详细错误信息
  - 位置：`frontend/src/components/VoiceInput.tsx`
  - 根据错误类型显示不同的错误提示
  - 提供操作按钮（重试、查看帮助、使用文本输入）

## 4. 添加错误恢复机制

- [x] 4.1 实现重试机制
  - 在 `VoiceInput` 组件中添加重试按钮
  - 重试时重新检查模型文件并尝试加载
  - 限制重试次数，避免无限循环

- [x] 4.2 实现优雅降级
  - 模型加载失败时，自动隐藏语音输入按钮
  - 显示友好的提示信息，引导用户使用文本输入
  - 确保文本输入功能始终可用

- [x] 4.3 添加错误边界保护
  - 在 `VoiceInput` 组件中实现优雅降级（错误时返回 null）
  - 捕获组件内部的未处理错误，防止影响整个页面
  - 显示降级UI，允许用户继续使用其他功能

## 5. 完善错误日志和调试信息

- [x] 5.1 添加详细日志记录
  - 记录模型加载的每个步骤（开始加载、检查文件、加载进度、完成/失败）
  - 记录错误详情（错误类型、错误消息、堆栈信息）
  - 使用 `console.error` 记录错误，便于开发调试

- [x] 5.2 添加调试工具函数
  - 创建 `checkVoiceInputSetup` 函数，检查语音输入功能的配置状态
  - 检查项包括：
    - WebAssembly 支持
    - vosk-browser 包是否安装
    - 模型文件是否存在
    - 浏览器权限（麦克风）
  - 在开发模式下提供调试面板

## 6. 验证和测试

- [ ] 6.1 测试模型文件不存在的情况
  - 删除模型文件，验证错误提示是否正确
  - 验证降级机制是否正常工作

- [ ] 6.2 测试模型路径错误的情况
  - 修改模型路径为错误路径，验证错误处理
  - 验证错误消息是否清晰

- [ ] 6.3 测试网络错误情况
  - 模拟网络断开，验证错误处理
  - 验证重试机制是否正常工作

- [ ] 6.4 测试错误不会导致服务崩溃
  - 验证所有错误都被正确捕获
  - 验证错误不会导致未处理的 Promise 拒绝
  - 验证前端错误不会影响后端服务

- [ ] 6.5 测试完整流程
  - 正常加载模型并录音
  - 模型加载失败后的降级流程
  - 重试机制的工作流程
