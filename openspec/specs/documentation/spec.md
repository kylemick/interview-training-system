# Capability: Documentation (项目文档管理)

## Purpose

项目文档管理能力确保项目文档（`openspec/project.md`）与代码实现保持同步，准确反映当前的技术栈、项目结构、功能模块和能力列表。该能力定义了文档更新的标准流程、检查清单和准确性要求，帮助开发者快速了解项目当前状态和已实现功能。

## Requirements

### Requirement: 项目文档完整性要求
系统SHALL维护准确、完整的项目文档，反映当前实现状态。

#### Scenario: 文档与代码同步
- **WHEN** 代码实现发生变化（新增功能、修改架构、更新技术栈）
- **THEN** 项目文档（`openspec/project.md`）应在变更完成后及时更新
- **AND** 文档应准确反映当前的技术栈、项目结构、功能模块和能力列表
- **AND** 文档更新应作为变更实施的一部分，在任务清单中明确标注

#### Scenario: 文档审查检查清单
- **WHEN** 更新项目文档时
- **THEN** 应检查以下内容是否准确：
  - 技术栈版本和依赖
  - 项目目录结构
  - 已实现的功能模块列表
  - 已归档的能力列表
  - 开发规范和约束条件（包括AI调用超时规范、前端组件使用规范、繁體中文規範等）
  - API端点列表（如适用）
  - 数据库表结构概览（如适用）

### Requirement: 能力状态追踪
系统SHALL在项目文档中明确列出所有能力及其实现状态。

#### Scenario: 列出已归档能力
- **WHEN** 查看项目文档的能力列表
- **THEN** 应列出所有已归档到 `openspec/specs/` 的能力
- **AND** 每个能力应标注其状态（已实现、部分实现、待实现）
- **AND** 应提供到对应spec文件的链接或路径

#### Scenario: 列出待归档能力
- **WHEN** 查看项目文档的能力列表
- **THEN** 应列出所有在变更中定义但尚未归档的能力
- **AND** 应标注其来源变更ID和当前状态
- **AND** 应说明归档计划或待办事项

### Requirement: 文档更新流程
系统SHALL定义文档更新的标准流程，确保文档与代码保持同步。

#### Scenario: 变更实施时更新文档
- **WHEN** 实施一个变更（change）时
- **THEN** 如果变更影响项目文档内容（技术栈、结构、能力等）
- **AND** 应在 `tasks.md` 中包含文档更新任务
- **AND** 文档更新应在变更归档前完成
- **AND** 文档更新应通过代码审查验证

#### Scenario: 定期文档审查
- **WHEN** 项目进行重大里程碑或发布前
- **THEN** 应进行全面的文档审查
- **AND** 验证文档与代码实现的一致性
- **AND** 更新过时的信息
- **AND** 补充缺失的说明

### Requirement: 技术栈文档准确性
系统SHALL在项目文档中准确记录实际使用的技术栈和版本。

#### Scenario: 技术栈版本更新
- **WHEN** 项目依赖或技术栈版本发生变化
- **THEN** 项目文档中的技术栈部分应及时更新
- **AND** 应记录版本号（如 React 18+, Node.js 18+）
- **AND** 应说明版本要求的原因（如兼容性、功能需求）

#### Scenario: 新增技术依赖
- **WHEN** 项目引入新的技术依赖或工具
- **THEN** 项目文档应更新技术栈列表
- **AND** 应说明新技术的用途和选择理由
- **AND** 应在"外部依赖"部分说明安装和配置要求

### Requirement: 项目结构文档准确性
系统SHALL在项目文档中准确描述项目的目录结构和组织方式。

#### Scenario: 目录结构变更
- **WHEN** 项目目录结构发生变化（新增目录、重组文件）
- **THEN** 项目文档中的"项目结构"部分应及时更新
- **AND** 应说明主要目录的用途和内容
- **AND** 应标注关键文件的位置

#### Scenario: 模块组织说明
- **WHEN** 查看项目结构文档
- **THEN** 应能理解项目的模块化组织方式
- **AND** 应了解前后端分离的架构
- **AND** 应了解OpenSpec规范的组织方式

## ADDED Requirements

### Requirement: AI调用超时规范文档要求
系统SHALL在项目文档中明确记录AI调用的超时规范，确保所有AI相关接口遵循无超时限制的要求。

#### Scenario: AI调用超时规范记录
- **WHEN** 查看项目文档的约束条件部分
- **THEN** 应明确说明所有AI调用接口必须设置 `timeout: 0`（无超时限制）
- **AND** 应列出需要遵循此规范的所有AI相关接口类型
- **AND** 应提供后端和前端的具体实现示例
- **AND** 应说明原因（AI处理可能需要较长时间，不应因超时而中断）

#### Scenario: AI调用超时规范检查
- **WHEN** 实施涉及AI调用的变更时
- **THEN** 应在文档审查检查清单中验证新接口是否遵循超时规范
- **AND** 应在代码审查中检查AI接口的超时设置
- **AND** 应在任务清单中明确标注需要遵循此规范

### Requirement: 前端通用组件规范文档要求
系统SHALL在项目文档中明确记录前端AI交互组件的使用规范，确保所有AI调用页面使用统一的悬浮框组件。

#### Scenario: 前端组件规范记录
- **WHEN** 查看项目文档的约束条件部分
- **THEN** 应明确说明所有AI调用页面必须使用通用悬浮框组件（`AiThinkingDisplay`）
- **AND** 应说明组件的位置和用法（`frontend/src/components/AiThinkingDisplay/`）
- **AND** 应列出需要使用此组件的所有页面类型
- **AND** 应说明原因（保持用户体验一致性，避免各自实现不同的loading提示）

#### Scenario: 前端组件规范检查
- **WHEN** 实施涉及AI调用的前端页面变更时
- **THEN** 应在文档审查检查清单中验证新页面是否使用通用悬浮框组件
- **AND** 应在代码审查中检查AI调用页面是否集成 `AiThinkingDisplay` 组件
- **AND** 应在任务清单中明确标注需要使用通用组件
