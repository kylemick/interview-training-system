# Question Bank Capability Updates

## MODIFIED Requirements

### Requirement: 题目数据模型
系统SHALL定义标准化的题目数据结构，支持七大专项类别，并支持分类历史追踪。

#### Scenario: 存储题目元数据
- **WHEN** 系统创建或导入题目
- **THEN** 每道题目包含：唯一ID、专项类别、难度等级、学校标签、题目文本、参考答案、评分标准
- **AND** 可选字段：创建时间、来源（手动/AI生成）、使用次数、平均得分
- **AND** 新增字段：分类置信度（0-1）、分类来源（auto/manual）、最后分类更新时间）

#### Scenario: 分类历史追踪
- **WHEN** 题目的分类被更新
- **THEN** 系统在 `question_category_history` 表中记录变更历史
- **AND** 记录包含：题目ID、旧分类、新分类、更新时间、更新原因
- **AND** 支持查询题目的分类变更历史

### Requirement: AI生成题目
系统SHALL使用AI生成题目以扩充题库，并支持从面试回忆中提取题目。生成题目时必须遵循类别语言规范，并使用增强的分类能力。

#### Scenario: 生成指定类别题目
- **WHEN** 用户请求生成N道指定类别的题目
- **THEN** 系统调用AI API，提供类别、难度、学校上下文
- **AND** 对于english-oral类别，提示词明确要求全英文输出
- **AND** 对于其他类别，使用中文输出
- **AND** AI返回题目列表（JSON格式），包含题目文本、参考答案、评分标准
- **AND** 系统验证并保存生成的题目，标注来源为"AI生成"
- **AND** 自动分类置信度标记，低置信度分类标记为"待确认"

#### Scenario: 增强分类提示词
- **WHEN** AI生成或分类题目时
- **THEN** 提示词中包含历史分类示例和常见误分类模式
- **AND** 使用few-shot learning方式提供正确分类示例
- **AND** 对于不确定分类，返回置信度分数和"待确认"标记

## ADDED Requirements

### Requirement: 分类规则管理
系统SHALL支持管理和优化问题类型分类规则，确保分类准确性持续提升。

#### Scenario: 存储分类规则
- **WHEN** 系统优化分类规则
- **THEN** 分类规则存储在 `category_classification_rules` 表中
- **AND** 规则包含：提示词模板、示例数据、版本号、创建时间
- **AND** 支持多版本规则并存，可以切换使用

#### Scenario: 分类规则版本管理
- **WHEN** 管理员更新分类规则
- **THEN** 系统创建新版本规则，保留旧版本
- **AND** 可以查看规则变更历史
- **AND** 可以回滚到之前的规则版本

#### Scenario: 分类准确性评估
- **WHEN** 系统积累了用户手动修正的分类数据
- **THEN** 系统计算当前分类规则的准确率
- **AND** 识别常见误分类模式
- **AND** 生成分类准确性报告，建议规则优化方向

### Requirement: 批量分类更新
系统SHALL支持批量更新历史题目的分类，确保与新分类规则保持一致。

#### Scenario: 预览分类更新
- **WHEN** 用户触发批量分类更新
- **THEN** 系统分析所有题目，生成更新预览
- **AND** 显示将变更的题目数量和列表
- **AND** 显示变更统计（按类别分组）
- **AND** 用户可以查看每个题目的新旧分类对比

#### Scenario: 执行批量更新
- **WHEN** 用户确认执行批量分类更新
- **THEN** 系统批量更新所有相关题目的分类
- **AND** 记录每次变更到分类历史表
- **AND** 更新完成后显示更新统计
- **AND** 支持取消操作（在更新过程中）

#### Scenario: 更新影响分析
- **WHEN** 批量分类更新执行前
- **THEN** 系统分析更新对相关数据的影响
- **AND** 识别将受影响的会话、反馈、统计记录
- **AND** 生成影响范围报告供用户参考
