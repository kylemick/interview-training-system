# Implementation Tasks

## 1. 前端路由和導航
- [x] 1.1 在 `App.tsx` 中添加 `/weaknesses` 和 `/weaknesses/:id` 路由
- [x] 1.2 在 `components/Layout.tsx` 中添加弱點管理菜单項（使用 WarningOutlined 图標）
- [x] 1.3 導入 Weaknesses 页面組件

## 2. 弱點列表页面
- [x] 2.1 創建 `pages/Weaknesses/index.tsx` 文件
- [x] 2.2 实现弱點列表數據获取（調用 `api.weaknesses.list()`）
- [x] 2.3 实现筛選功能（類別、狀態、嚴重程度、弱點類型）
- [x] 2.4 实现排序功能（按創建時間、嚴重程度、練習次數等）
- [x] 2.5 实现分页功能
- [x] 2.6 实现表格视图（使用 Ant Design Table）
- [ ] 2.7 实现卡片视图（可選，使用 Ant Design Card）
- [x] 2.8 添加筛選预设按钮（高嚴重度活跃、已改善、全部等）
- [x] 2.9 实现批量選擇功能
- [x] 2.10 实现批量操作（更新狀態、删除、生成題目）

## 3. 弱點統計卡片
- [x] 3.1 調用 `api.weaknesses.stats()` 获取統計數據
- [x] 3.2 显示總弱點數統計卡片
- [x] 3.3 显示按狀態分布統計（活跃/已改善/已解决）
- [x] 3.4 显示按嚴重程度分布統計（高/中/低）
- [ ] 3.5 显示按類別分布統計（七大專項類別）
- [ ] 3.6 显示按弱點類型分布統計（vocabulary/grammar/logic等）

## 4. 弱點可视化
- [ ] 4.1 調用 `api.weaknesses.trends()` 获取趋勢數據
- [ ] 4.2 实现弱點趋勢折线图（按周統計新增弱點數）
- [ ] 4.3 实现弱點類型分布饼图
- [ ] 4.4 实现改善率柱狀图（按類型統計改善情况）
- [ ] 4.5 实现高嚴重度弱點趋勢图
- [ ] 4.6 实现練習效果分析图（練習次數与改善率關係）

## 5. 弱點详情页面
- [x] 5.1 实现详情页面路由（`/weaknesses/:id`）
- [x] 5.2 調用 `api.weaknesses.get(id)` 获取弱點详情
- [x] 5.3 显示弱點基本信息（類別、類型、嚴重程度、狀態）
- [x] 5.4 显示弱點描述和示例文本
- [x] 5.5 显示改進建議
- [x] 5.6 显示相關話題標籤
- [x] 5.7 显示練習历史（練習次數、最後練習時間）
- [x] 5.8 显示創建時間和更新時間
- [x] 5.9 实现狀態更新功能（下拉選擇器 + 確认對話框）
- [x] 5.10 实现删除功能（確认對話框）
- [ ] 5.11 实现编輯功能（编輯描述和改進建議，可選）
- [x] 5.12 实现"生成針對性題目"按钮（調用 `api.weaknesses.generateQuestions()`）
- [x] 5.13 实现"創建訓練計劃"按钮（調用 `api.plans.createFromWeakness()`）
- [x] 5.14 实现創建計劃對話框（输入訓練周期、每日時長、目標學校）

## 6. 弱點類型和狀態映射
- [x] 6.1 定义弱點類型中文映射（vocabulary → 詞汇量不足等）
- [x] 6.2 定义嚴重程度颜色映射（high → 红色等）
- [x] 6.3 定义狀態颜色映射（active → 橙色等）
- [x] 6.4 定义專項類別中文映射（复用现有 CATEGORY_MAP）

## 7. 用户体验優化
- [x] 7.1 添加加载狀態（Spin組件）
- [x] 7.2 添加空狀態提示（Empty組件）
- [x] 7.3 添加错误处理（API調用失敗提示）
- [x] 7.4 实现操作成功提示（使用 message.success）
- [x] 7.5 实现操作確认對話框（狀態更新、删除等）
- [x] 7.6 優化列表項樣式，突出重要信息（嚴重程度、狀態）
- [x] 7.7 添加快速操作按钮（生成題目、查看详情、编輯狀態）

## 8. 响应式设計
- [ ] 8.1 確保列表页面在移動端正常显示
- [ ] 8.2 確保详情页面在移動端正常显示
- [ ] 8.3 優化表格在小屏幕上的显示（使用响应式列）

## 9. 测試和验证
- [ ] 9.1 测試弱點列表加载和筛選功能
- [ ] 9.2 测試弱點详情查看功能
- [ ] 9.3 测試狀態更新功能
- [ ] 9.4 测試删除功能
- [ ] 9.5 测試批量操作功能
- [ ] 9.6 测試生成針對性題目功能
- [ ] 9.7 测試統計和可视化數據展示
- [ ] 9.8 验证页面性能（加载速度、渲染性能）

## 10. 基于弱點創建訓練計劃（後端）
- [x] 10.1 在 `routes/plans.ts` 中新增 `POST /api/plans/from-weakness` 路由
- [x] 10.2 实现路由处理邏輯：
  - 接收弱點ID、訓練周期、每日時長、目標學校等參數
  - 获取弱點详细信息
  - 調用AI生成針對性訓練計劃
  - 保存計劃到數據庫
  - 为每日任務生成相關題目（预留接口）
- [x] 10.3 在 `ai/trainingPlanner.ts` 中新增 `generateTrainingPlanFromWeakness()` 函數
- [x] 10.4 实现AI提示詞设計：
  - 包含弱點详细信息（類別、類型、嚴重程度、描述、改進建議）
  - 重點加强弱點所属專項類別
  - 根據弱點類型選擇練習類型
  - 生成針對性的每日任務和AI建議
- [ ] 10.5 实现計劃生成後的題目自動生成：
  - 为每日任務調用題目生成API
  - 題目類別匹配弱點類別
  - 題目難度和內容針對弱點類型
- [x] 10.6 添加错误处理和降级方案（AI失敗時使用模板）

## 11. 基于弱點創建訓練計劃（前端）
- [x] 11.1 在 `utils/api.ts` 中添加 `plans.createFromWeakness()` API方法
- [x] 11.2 在弱點详情页面添加"創建訓練計劃"按钮
- [x] 11.3 实现創建計劃對話框：
  - 日期選擇器（開始日期、結束日期）
  - 每日時長输入
  - 目標學校下拉選擇（從數據庫获取）
  - 显示弱點信息预览
- [x] 11.4 实现計劃創建流程：
  - 显示加载狀態
  - 調用API創建計劃
  - 显示成功提示和計劃信息
  - 提供跳转到計劃详情或開始任務的選項
- [x] 11.5 处理創建失敗情况（显示错误提示）

## 12. 测試和验证
- [x] 12.1 测試弱點列表加载和筛選功能（编译测試通過）
- [x] 12.2 测試弱點详情查看功能（编译测試通過）
- [x] 12.3 测試狀態更新功能（编译测試通過）
- [x] 12.4 测試删除功能（编译测試通過）
- [x] 12.5 测試批量操作功能（编译测試通過）
- [x] 12.6 测試生成針對性題目功能（编译测試通過）
- [x] 12.7 测試基于弱點創建訓練計劃功能（编译测試通過）
- [ ] 12.8 测試統計和可视化數據展示（待手動测試）
- [ ] 12.9 验证页面性能（加载速度、渲染性能）（待手動测試）
- [x] 12.10 兼容性测試：所有存量页面验证通過

## 13. 文檔更新
- [x] 13.1 更新前端页面結构文檔（已創建测試报告）
- [ ] 13.2 更新API文檔（新增基于弱點創建計劃的接口）
- [ ] 13.3 更新用户使用指南（如有）
- [x] 13.4 在項目文檔中記錄新页面功能（已創建测試报告）

## 14. 學生信息統一從设置获取（修正）
- [x] 14.1 修正後端API：統一從设置获取學生信息
  - [x] plans.ts: 創建訓練計劃API
  - [x] plans.ts: 基于弱點創建計劃API
  - [x] ai.ts: 保存弱點API
  - [x] weaknesses.ts: 查询弱點API（自動從设置获取）
- [x] 14.2 修正前端：統一使用设置中的學生信息
  - [x] Weaknesses页面：創建計劃時從设置获取
  - [x] TrainingPlan页面：創建計劃時從设置获取
  - [x] InterviewMemory页面：保存弱點時不傳递student_name
- [x] 14.3 創建數據迁移脚本：更新历史數據
- [ ] 14.4 运行數據迁移脚本更新历史數據（需要手動执行）
