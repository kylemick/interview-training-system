# Implementation Tasks

## 1. 後端API增强
- [x] 1.1 創建"获取未完成任務"API (`GET /api/plans/pending-tasks`)
- [x] 1.2 修改"創建會話"API,支持從任務ID創建會話并自動選擇題目
- [x] 1.3 修改"完成會話"API,自動標記關聯任務为完成
- [x] 1.4 創建"從任務創建會話"專用API (`POST /api/plans/tasks/:taskId/start-practice`)
- [x] 1.5 在會話详情API中返回關聯的任務和計劃信息

## 2. 數據庫Schema調整
- [x] 2.1 確认`sessions.task_id`外键约束正確设置
- [x] 2.2 添加索引優化任務-會話關聯查询
- [x] 2.3 编写數據迁移脚本(如果需要)

## 3. 前端Dashboard页面
- [x] 3.1 在Dashboard添加"今日任務"卡片,显示未完成的每日任務列表
- [x] 3.2 为每个任務添加"開始練習"按钮,點击後跳转到練習页面并自動加载題目
- [x] 3.3 显示任務完成進度条
- [x] 3.4 区分"計劃內練習"和"自由練習"的統計數據

## 4. 前端訓練計劃页面
- [x] 4.1 在每日任務卡片上添加"開始"按钮
- [x] 4.2 显示任務狀態(待開始/進行中/已完成)
- [x] 4.3 點击"開始"按钮後,跳转到練習页面并傳递`taskId`參數

## 5. 前端練習页面重构
- [x] 5.1 支持從URL參數接收`taskId`
- [x] 5.2 如果有`taskId`,自動從任務加载題目,无需用户選擇類別
- [x] 5.3 在練習页面顶部显示任務信息横幅(計劃名称、日期、類別、進度)
- [x] 5.4 保留"自由練習"入口,允许用户不關聯任務進行練習
- [x] 5.5 完成練習後,如果關聯了任務,显示"任務已完成"提示

## 6. 練習流程優化
- [x] 6.1 練習完成後,自動調用API標記任務完成
- [x] 6.2 如果有多个未完成任務,完成当前任務後提示"继续下一个任務"
- [x] 6.3 所有任務完成後,显示"今日任務全部完成"庆祝動画
- [x] 6.4 添加"跳過任務"選項(標記为已完成但不練習)

## 7. 用户体验增强
- [ ] 7.1 在侧边栏導航添加任務計數徽章(显示今日未完成任務數)
- [ ] 7.2 練習页面支持"暫停并保存"(關聯任務ID)
- [ ] 7.3 重新進入練習页面時,检测是否有未完成的會話,提示恢复
- [ ] 7.4 添加"任務历史"页面,查看過往完成的任務記錄
- [x] 7.5 優化任務信息横幅,显示更详细的計劃信息(目標學校、學生姓名等)
- [ ] 7.6 添加任務完成統計卡片(今日完成數、總時長、平均分等)

## 8. 错误处理和边界情况
- [x] 8.1 处理任務不存在的情况(404错误)
- [x] 8.2 处理題目數量不足的情况(返回错误提示)
- [x] 8.3 处理任務已有未完成會話的情况(自動返回现有會話,前端显示"继续練習")
- [ ] 8.4 处理网络错误時的重試机制
- [ ] 8.5 处理會話創建失敗時的回滚邏輯

## 9. 测試
- [ ] 9.1 单元测試: 测試任務-會話關聯邏輯
- [ ] 9.2 集成测試: 創建計劃→開始任務→完成練習→任務標記完成
- [ ] 9.3 边界测試: 无計劃時"自由練習"模式
- [ ] 9.4 UI测試: Dashboard和訓練計劃页面交互
- [ ] 9.5 手動测試: 完整用户流程体验
- [ ] 9.6 性能测試: 大量任務時的查询性能

## Validation Criteria

### 核心功能验证
每个任務完成後需验证:
- ✅ API返回正確的任務和會話關聯數據
- ✅ 前端正確显示任務信息和狀態
- ✅ 完成練習後,任務狀態自動更新
- ✅ "自由練習"模式不受影响,可以独立使用
- ✅ 错误处理到位(任務不存在、會話創建失敗等)

### 完整流程验证
- ✅ 創建訓練計劃→查看Dashboard今日任務→開始任務練習→完成練習→任務自動標記完成
- ✅ 所有任務完成後,Dashboard显示"今日无待办任務"或庆祝提示
- ✅ 无計劃時,仍可進入"自由練習"模式
- ✅ 任務狀態和進度条实時更新
- ✅ 任務完成後智能引導(继续下一个或庆祝全部完成)

### 待验证功能
- [ ] 任務跳過功能正常工作
- [ ] 任務恢复功能(如果实现)
- [ ] 導航栏任務徽章实時更新
- [ ] 統計數據正確区分計劃內和自由練習

## 後续優化建議

### 短期優化(1-2周)
1. **实现任務跳過功能**: 允许用户直接標記任務完成而不練習
2. **添加導航栏徽章**: 在侧边栏显示今日未完成任務數,提升可见性
3. **優化错误提示**: 更友好的错误消息和重試机制

### 中期優化(1个月)
1. **任務恢复功能**: 支持暫停後继续未完成的會話
2. **統計數據区分**: Dashboard分別显示計劃內和自由練習的統計
3. **任務历史页面**: 查看過往完成的任務記錄和趋勢

### 長期優化(3个月+)
1. **智能推荐**: 根據完成情况推荐下一个任務
2. **任務依赖**: 支持任務之間的依赖關係
3. **進度分析**: 深度分析任務完成情况和訓練效果
