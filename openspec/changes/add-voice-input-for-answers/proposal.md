# Change: 添加语音输入功能优化答案提交交互

## Why

当前系统中，用户只能通过纯文本输入提交答案，这对于小学生用户来说存在以下问题：

1. **输入效率低**：小学生打字速度慢，手工输入答案耗时较长，影响练习流畅度
2. **表达受限**：文字输入可能限制学生的自然表达，无法充分利用口语表达能力
3. **体验不友好**：对于口语类题目（如英文口语、中文表达），语音输入更符合实际面试场景
4. **多语言支持不足**：系统需要支持中文、英文、粤语三种语言，语音识别可以更好地处理多语言场景

通过添加语音识别功能，学生可以通过说话的方式输入答案，系统自动将语音转换为文本，替代手工输入，提升用户体验和练习效率。

## What Changes

### 核心功能
- **语音输入模式**：在答案输入区域添加语音输入按钮，支持一键启动/停止录音
- **实时语音识别**：使用浏览器 Web Speech API 进行实时语音转文字
- **多语言支持**：支持中文（普通话）、英文两种语言的语音识别
- **识别结果展示**：实时显示识别结果，支持手动编辑修正
- **输入方式切换**：用户可以在语音输入和文本输入之间自由切换
- **录音状态反馈**：提供清晰的录音状态指示（录音中、识别中、识别完成）

### 用户体验增强
- 在答案输入区域添加"🎤 语音输入"按钮，点击后开始录音
- 录音过程中显示录音时长和波形动画，提供视觉反馈
- 识别完成后自动填充到文本输入框，用户可继续编辑
- 支持多次录音，可以追加或替换已有内容
- 提供语言选择器，用户可以选择识别语言（中文/英文）
- 识别错误时支持手动编辑修正

### 技术实现
- **前端**：
  - 使用 **Vosk.js** 进行本地离线语音识别（不使用 Google/Apple 服务）
  - 通过 WebAssembly 在浏览器中运行识别模型
  - 使用 Web Audio API 进行音频采集
  - 创建语音输入组件 `components/VoiceInput.tsx`
  - 在 `pages/Practice/index.tsx` 中集成语音输入功能
  - 添加语言选择下拉菜单
  - 实现模型加载和缓存机制（IndexedDB）
  - 处理浏览器兼容性和降级方案
- **后端**：
  - 无需修改后端API，语音识别在前端完成，最终仍以文本形式提交
  - 保持现有答案提交流程不变
  - （可选）如果 Vosk 方案不满足需求，可添加讯飞API代理接口作为备选方案

**非BREAKING**：这是新增功能，不影响现有文本输入功能。用户可以选择使用语音输入或继续使用文本输入。

## Impact

### 影响规范
- **interview-practice** (修改): 扩展文字问答模式，添加语音输入作为替代输入方式

### 影响代码
- **前端**:
  - `pages/Practice/index.tsx`: 集成语音输入组件，添加语言选择器
  - `components/VoiceInput.tsx`: 新建语音输入组件（录音、识别、状态管理）
  - `utils/speechRecognition.ts`: 新建语音识别工具函数（封装浏览器API，处理兼容性）
  - `App.tsx`: 无需修改（路由不变）
- **后端**:
  - 无需修改（答案仍以文本形式提交）

### 实现状态
- 📋 **待实现**: 所有功能待开发

## Benefits

1. **提升效率**：语音输入比手工打字快3-5倍，特别适合小学生用户
2. **自然表达**：语音输入更符合口语练习场景，学生可以更自然地组织语言
3. **多语言支持**：支持中文、英文两种语言识别
4. **用户体验**：降低输入门槛，让更多学生能够流畅使用系统
5. **隐私保护**：完全本地处理，语音数据不离开用户设备，符合隐私优先原则
6. **向后兼容**：保留文本输入功能，用户可根据习惯选择输入方式
7. **离线支持**：模型下载后可在离线环境使用（首次需要网络下载模型）

## Constraints

1. **浏览器兼容性**：
   - 需要支持 WebAssembly 的现代浏览器（Chrome、Edge、Firefox、Safari 等）
   - 不支持 WebAssembly 的旧版浏览器需要降级到文本输入
   - 需要检测浏览器支持情况，不支持的浏览器自动隐藏语音输入按钮

2. **模型文件**：
   - 每种语言的识别模型约50MB，首次使用需要下载
   - 模型文件需要存储在 CDN 或本地服务器
   - 浏览器使用 IndexedDB 缓存模型，避免重复下载
   - 首次加载可能需要等待，需要提供加载进度提示

3. **隐私和数据安全**：
   - **不使用 Google/Apple 语音识别服务**，所有处理在本地完成
   - 语音数据完全在用户设备上处理，不离开浏览器
   - 符合本地部署的隐私优先原则

4. **识别准确性**：
   - 本地识别准确率可能低于云端服务，特别是对于口音、噪音环境
   - 需要提供手动编辑功能，允许用户修正识别错误
   - 如果准确率不满足需求，可考虑切换到讯飞API方案（需要后端支持）

5. **性能考虑**：
   - 在浏览器中运行识别模型可能消耗较多CPU和内存
   - 低端设备可能需要降级到文本输入
   - 需要优化模型加载和运行性能
