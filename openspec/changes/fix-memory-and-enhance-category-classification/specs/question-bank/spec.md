# Question Bank Capability Updates

## MODIFIED Requirements

### Requirement: 題目數據模型
係統SHALL定义標準化的題目數據結构，支持七大專項類別，并支持分類历史追踪。

#### Scenario: 存储題目元數據
- **WHEN** 係統創建或導入題目
- **THEN** 每道題目包含：唯一ID、專項類別、難度等级、學校標籤、題目文本、參考答案、評分標準
- **AND** 可選字段：創建時間、來源（手動/AI生成）、使用次數、平均得分
- **AND** 新增字段：分類置信度（0-1）、分類來源（auto/manual）、最後分類更新時間）

#### Scenario: 分類历史追踪
- **WHEN** 題目的分類被更新
- **THEN** 係統在 `question_category_history` 表中記錄变更历史
- **AND** 記錄包含：題目ID、舊分類、新分類、更新時間、更新原因
- **AND** 支持查询題目的分類变更历史

### Requirement: AI生成題目
係統SHALL使用AI生成題目以扩充題庫，并支持從面試回憶中提取題目。生成題目時必须遵循類別語言規范，并使用增强的分類能力。

#### Scenario: 生成指定類別題目
- **WHEN** 用户请求生成N道指定類別的題目
- **THEN** 係統調用AI API，提供類別、難度、學校上下文
- **AND** 對于english-oral類別，提示詞明確要求全英文输出
- **AND** 對于其他類別，使用中文输出
- **AND** AI返回題目列表（JSON格式），包含題目文本、參考答案、評分標準
- **AND** 係統验证并保存生成的題目，標注來源为"AI生成"
- **AND** 自動分類置信度標記，低置信度分類標記为"待確认"

#### Scenario: 增强分類提示詞
- **WHEN** AI生成或分類題目時
- **THEN** 提示詞中包含历史分類示例和常见误分類模式
- **AND** 使用few-shot learning方式提供正確分類示例
- **AND** 對于不確定分類，返回置信度分數和"待確认"標記

## ADDED Requirements

### Requirement: 分類規則管理
係統SHALL支持管理和優化問題類型分類規則，確保分類準確性持续提升。

#### Scenario: 存储分類規則
- **WHEN** 係統優化分類規則
- **THEN** 分類規則存储在 `category_classification_rules` 表中
- **AND** 規則包含：提示詞模板、示例數據、版本號、創建時間
- **AND** 支持多版本規則并存，可以切换使用

#### Scenario: 分類規則版本管理
- **WHEN** 管理员更新分類規則
- **THEN** 係統創建新版本規則，保留舊版本
- **AND** 可以查看規則变更历史
- **AND** 可以回滚到之前的規則版本

#### Scenario: 分類準確性評估
- **WHEN** 係統积累了用户手動修正的分類數據
- **THEN** 係統計算当前分類規則的準確率
- **AND** 識別常见误分類模式
- **AND** 生成分類準確性报告，建議規則優化方向

### Requirement: 批量分類更新
係統SHALL支持批量更新历史題目的分類，確保与新分類規則保持一致。

#### Scenario: 预览分類更新
- **WHEN** 用户触發批量分類更新
- **THEN** 係統分析所有題目，生成更新预览
- **AND** 显示将变更的題目數量和列表
- **AND** 显示变更統計（按類別分組）
- **AND** 用户可以查看每个題目的新舊分類對比

#### Scenario: 执行批量更新
- **WHEN** 用户確认执行批量分類更新
- **THEN** 係統批量更新所有相關題目的分類
- **AND** 記錄每次变更到分類历史表
- **AND** 更新完成後显示更新統計
- **AND** 支持取消操作（在更新過程中）

#### Scenario: 更新影响分析
- **WHEN** 批量分類更新执行前
- **THEN** 係統分析更新對相關數據的影响
- **AND** 識別将受影响的會話、反馈、統計記錄
- **AND** 生成影响范围报告供用户參考
