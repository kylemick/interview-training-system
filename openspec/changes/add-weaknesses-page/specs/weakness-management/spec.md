## ADDED Requirements

### Requirement: 弱点列表展示
系统SHALL提供弱点列表页面，支持多维度筛选、排序和分页。

#### Scenario: 查看弱点列表
- **WHEN** 用户访问 `/weaknesses` 页面
- **THEN** 系统显示所有弱点记录的列表
- **AND** 每个弱点显示：类别、弱点类型、严重程度、状态、描述、创建时间
- **AND** 列表支持按严重程度降序、创建时间降序排序（默认）

#### Scenario: 筛选弱点
- **WHEN** 用户在弱点列表页面使用筛选器
- **THEN** 系统支持按以下维度筛选：
  - 专项类别（七大类别：english-oral, chinese-oral等）
  - 状态（active/improved/resolved）
  - 严重程度（high/medium/low）
  - 弱点类型（vocabulary/grammar/logic/knowledge_gap/confidence/expression）
- **AND** 筛选条件可以组合使用
- **AND** 筛选结果实时更新

#### Scenario: 筛选预设
- **WHEN** 用户点击筛选预设按钮
- **THEN** 系统提供以下预设：
  - "高严重度活跃弱点"（severity=high, status=active）
  - "已改善弱点"（status=improved）
  - "已解决弱点"（status=resolved）
  - "全部弱点"（清除所有筛选）
- **AND** 点击预设后自动应用对应筛选条件

#### Scenario: 分页浏览
- **WHEN** 弱点数量超过单页显示限制
- **THEN** 系统提供分页控件
- **AND** 默认每页显示20条记录
- **AND** 用户可以调整每页显示数量（10/20/50/100）

### Requirement: 弱点详情查看
系统SHALL提供弱点详情页面，展示弱点的完整信息。

#### Scenario: 查看弱点详情
- **WHEN** 用户点击弱点列表中的某个弱点或访问 `/weaknesses/:id`
- **THEN** 系统显示弱点的完整信息：
  - 基本信息：类别、弱点类型、严重程度、状态
  - 描述：弱点详细描述
  - 示例文本：体现弱点的原文片段
  - 改进建议：具体的改进建议
  - 相关话题：相关话题标签列表
  - 练习历史：已练习次数、最后练习时间
  - 时间信息：创建时间、更新时间
  - 来源信息：识别方式（ai/manual）、来源文本（如有）

#### Scenario: 弱点详情页面操作
- **WHEN** 用户在弱点详情页面
- **THEN** 系统提供以下操作：
  - 更新状态（active/improved/resolved）
  - 删除弱点（需确认）
  - 生成针对性题目（调用AI生成）
  - 创建训练计划（基于弱点生成针对性计划）
  - 返回列表（导航按钮）

### Requirement: 弱点状态管理
系统SHALL支持更新弱点的状态，并显示确认对话框。

#### Scenario: 更新弱点状态
- **WHEN** 用户在弱点详情页面或列表中选择更新状态
- **THEN** 系统显示状态选择器（active/improved/resolved）
- **AND** 用户选择新状态后，系统显示确认对话框
- **AND** 用户确认后，调用 `PATCH /api/weaknesses/:id/status` 更新状态
- **AND** 更新成功后显示成功提示并刷新数据

#### Scenario: 批量更新状态
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量更新状态"
- **THEN** 系统显示状态选择器
- **AND** 用户选择新状态后，系统显示确认对话框（显示将更新的数量）
- **AND** 用户确认后，批量调用API更新所有选中弱点的状态
- **AND** 更新完成后显示成功提示（显示成功更新的数量）

### Requirement: 弱点删除
系统SHALL支持删除弱点记录，并显示确认对话框。

#### Scenario: 删除单个弱点
- **WHEN** 用户在弱点详情页面点击删除按钮
- **THEN** 系统显示确认对话框，提示"确定要删除此弱点记录吗？"
- **AND** 用户确认后，调用 `DELETE /api/weaknesses/:id` 删除记录
- **AND** 删除成功后显示成功提示并返回列表页面

#### Scenario: 批量删除弱点
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量删除"
- **THEN** 系统显示确认对话框，提示"确定要删除选中的 X 条弱点记录吗？"
- **AND** 用户确认后，批量调用API删除所有选中弱点
- **AND** 删除完成后显示成功提示（显示成功删除的数量）

### Requirement: 弱点统计展示
系统SHALL在弱点管理页面展示统计信息。

#### Scenario: 显示统计卡片
- **WHEN** 用户访问弱点管理页面
- **THEN** 系统在页面顶部显示统计卡片：
  - 总弱点数
  - 按状态分布（活跃/已改善/已解决）
  - 按严重程度分布（高/中/低）
  - 按类别分布（七大专项类别）
  - 按弱点类型分布（vocabulary/grammar等）
- **AND** 统计数据通过调用 `GET /api/weaknesses/stats/summary` 获取

#### Scenario: 统计卡片交互
- **WHEN** 用户点击统计卡片
- **THEN** 系统可以跳转到对应筛选条件的弱点列表（可选功能）

### Requirement: 弱点趋势可视化
系统SHALL在弱点管理页面展示趋势图表。

#### Scenario: 显示趋势图表
- **WHEN** 用户访问弱点管理页面
- **THEN** 系统显示以下图表：
  - 弱点趋势折线图：按周统计新增弱点数
  - 弱点类型分布饼图：各类型弱点数量占比
  - 改善率柱状图：按类型统计改善情况（改善率 = (已改善+已解决)/总数）
  - 高严重度弱点趋势图：按周统计高严重度弱点数量
  - 练习效果分析图：练习次数与改善率的关系
- **AND** 图表数据通过调用 `GET /api/weaknesses/stats/trends` 获取
- **AND** 图表使用 ECharts 或 Ant Design Charts 渲染

#### Scenario: 趋势图表时间范围
- **WHEN** 用户查看趋势图表
- **THEN** 系统默认显示最近30天的数据
- **AND** 用户可以调整时间范围（7天/30天/90天/全部）

### Requirement: 生成针对性题目
系统SHALL支持根据弱点生成针对性练习题目。

#### Scenario: 为单个弱点生成题目
- **WHEN** 用户在弱点详情页面点击"生成针对性题目"按钮
- **THEN** 系统调用 `POST /api/ai/generate-questions-from-weaknesses`
- **AND** 请求参数包含弱点ID和题目数量（默认5道）
- **AND** 生成成功后显示成功提示，并跳转到题目列表或练习页面

#### Scenario: 批量生成题目
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量生成题目"
- **THEN** 系统显示对话框，让用户选择题目数量（每弱点生成数量）
- **AND** 用户确认后，调用API为所有选中弱点生成题目
- **AND** 生成完成后显示成功提示（显示生成的题目总数）

### Requirement: 导航和菜单集成
系统SHALL在系统导航菜单中添加弱点管理入口。

#### Scenario: 导航菜单入口
- **WHEN** 用户查看系统导航菜单
- **THEN** 菜单中包含"弱点管理"项（使用 WarningOutlined 图标）
- **AND** 点击后跳转到 `/weaknesses` 页面
- **AND** 菜单项在"进度报告"和"设置"之间（或根据逻辑顺序排列）

#### Scenario: 面包屑导航
- **WHEN** 用户在弱点详情页面
- **THEN** 系统显示面包屑导航：首页 > 弱点管理 > 弱点详情
- **AND** 点击"弱点管理"可返回列表页面

### Requirement: 响应式设计
系统SHALL确保弱点管理页面在不同设备上正常显示。

#### Scenario: 桌面端显示
- **WHEN** 用户在桌面浏览器访问弱点管理页面
- **THEN** 列表以表格形式显示，充分利用屏幕空间
- **AND** 统计卡片和图表并排显示

#### Scenario: 移动端显示
- **WHEN** 用户在移动设备访问弱点管理页面
- **THEN** 列表以卡片列表形式显示（或响应式表格）
- **AND** 统计卡片垂直排列
- **AND** 图表自适应屏幕宽度
- **AND** 筛选器以抽屉或折叠面板形式展示

### Requirement: 错误处理和用户反馈
系统SHALL提供适当的错误处理和用户反馈。

#### Scenario: 加载状态
- **WHEN** 系统正在加载弱点数据
- **THEN** 显示加载动画（Spin组件）
- **AND** 禁用操作按钮

#### Scenario: 空状态
- **WHEN** 弱点列表为空（无数据或筛选后无结果）
- **THEN** 显示空状态提示（Empty组件）
- **AND** 提供"清除筛选"或"返回"操作

#### Scenario: 错误处理
- **WHEN** API调用失败
- **THEN** 显示错误提示（message.error）
- **AND** 错误信息清晰易懂（如"获取弱点列表失败，请稍后重试"）

#### Scenario: 操作成功反馈
- **WHEN** 用户成功执行操作（更新状态、删除、生成题目等）
- **THEN** 显示成功提示（message.success）
- **AND** 自动刷新相关数据

### Requirement: 基于弱点创建训练计划
系统SHALL支持基于单个弱点使用AI创建针对性的训练计划，根据弱点的类别和类型选择合适的练习类型，并生成提升相关的题目。

#### Scenario: 创建基于弱点的训练计划
- **WHEN** 用户在弱点详情页面点击"创建训练计划"按钮
- **THEN** 系统显示对话框，让用户输入：
  - 训练周期（开始日期、结束日期）
  - 每日可用时长（分钟）
  - 目标学校（可选，从数据库学校列表选择）
- **AND** 系统根据弱点的以下信息生成针对性计划：
  - 专项类别（category）：重点加强该类别
  - 弱点类型（weakness_type）：针对具体问题类型设计练习
  - 严重程度（severity）：根据严重程度调整训练强度
  - 改进建议（improvement_suggestions）：纳入计划建议
  - 相关话题（related_topics）：作为练习重点

#### Scenario: AI生成针对性训练计划
- **WHEN** 用户确认创建训练计划
- **THEN** 系统调用 `POST /api/plans/from-weakness` API
- **AND** API根据弱点信息生成训练计划：
  - 重点分配弱点所属的专项类别（提高该类别占比）
  - 根据弱点类型选择相应的练习类型和题目类型
  - 生成针对性的每日任务，包含该专项类别的练习
  - 在AI建议中说明如何针对该弱点进行训练
- **AND** 计划生成后自动创建并保存到数据库
- **AND** 为计划中的每日任务自动生成相关题目（调用题目生成API）

#### Scenario: 训练计划生成结果
- **WHEN** 训练计划创建成功
- **THEN** 系统显示成功提示，包含：
  - 计划ID
  - 计划包含的每日任务数量
  - 重点训练的专项类别
- **AND** 提供操作选项：
  - 查看训练计划（跳转到计划详情页面）
  - 开始第一个任务（跳转到练习页面）
  - 返回弱点详情

#### Scenario: 计划中的题目生成
- **WHEN** 基于弱点创建训练计划时
- **THEN** 系统为计划中的每日任务自动生成题目
- **AND** 生成的题目：
  - 属于弱点相关的专项类别
  - 针对弱点的具体类型（如vocabulary类型生成词汇相关题目）
  - 难度适中，适合改善该弱点
  - 参考弱点的改进建议和相关话题
- **AND** 题目保存到题库并关联到对应的每日任务

#### Scenario: 多弱点创建计划（可选增强）
- **WHEN** 用户在弱点列表中选择多个弱点并点击"批量创建计划"
- **THEN** 系统分析所有选中弱点的类别分布
- **AND** 生成综合训练计划，重点加强出现频率高的专项类别
- **AND** 在计划建议中说明如何同时改善多个弱点
